C Test script to compare AUTOZ feature in Autolev for biomechanical 
C modelling application.
C
C AUTOZ: OFF
C
C   Tom Rottier 2020
C***********************************************************************
      PROGRAM MAIN
      IMPLICIT         DOUBLE PRECISION (A - Z)
C** Model variables
      INTEGER          ILOOP,PRINTINT
      INTEGER          I,J,NACTP,NROW,NCOL,N
      PARAMETER        (N=50,NACTP=7)
      CHARACTER        MESSAGE(99)
      DIMENSION        Y(500,11),X(N)
      DIMENSION        TT(500),CCHIP(6,500),CCKNEE(6,500),CCHAT(6,500)
      DIMENSION        HETQP(10),HFTQP(10),KETQP(10),KFTQP(10),AETQP(10)
     &,AFTQP(10),HEACTP(NACTP),HFACTP(NACTP),KEACTP(NACTP),KFACTP(NACTP)
     &,AEACTP(NACTP),AFACTP(NACTP),METQP(10),MFTQP(10)
      COMMON/CONSTNTS/ FOOTANG,G,IA,IB,IC,ID,IE,IF,IG,K1,K2,K3,K4,K5,K6,
     &K7,K8,L1,L10,L11,L2,L3,L4,L5,L6,L7,L8,L9,MA,MB,MC,MD,ME,MF,MG
      COMMON/INITIAL / Q1I,Q2I,Q3I,Q4I,Q5I,Q6I,Q7I,U1I,U2I,U3I,U4I,U5I,U
     &6I,U7I
      COMMON/MISCLLNS/ PI,DEGtoRAD,RADtoDEG,COEF(7,7),RHS(7)
      COMMON/INTEG   / TINITIAL,TFINAL,INTEGSTP,ABSERR,RELERR,PRINTINT
      COMMON/TQPARAMS/ HETQP,HFTQP,KETQP,KFTQP,AETQP,AFTQP,METQP,MFTQP
      COMMON/ACTPARAM/ HEACTP,HFACTP,KEACTP,KFACTP,AEACTP,AFACTP
      COMMON/SPLNCOEF/ TT,CCHIP,CCKNEE,CCHAT,NROW
      COMMON/DATAIN  / Y,AERIALTIME,SWINGTIME

C**   Open input file
      OPEN(UNIT=20, FILE='7segSprint.in', STATUS='OLD')

C**   Read message from input file
      READ(20,7000,END=7100,ERR=7101) (MESSAGE(ILOOP),ILOOP = 1,99)

C**   Read values of constants from input file
      READ(20,7010,END=7100,ERR=7101) FOOTANG,G,IA,IB,IC,ID,IE,IF,IG,K1,
     &K2,K3,K4,K5,K6,K7,K8,L1,L10,L11,L2,L3,L4,L5,L6,L7,L8,L9,MA,MB,MC,M
     &D,ME,MF,MG

C**   Read the initial value of each variable from input file
      READ(20,7010,END=7100,ERR=7101) Q1I,Q2I,Q3I,Q4I,Q5I,Q6I,Q7I,U1I,U2
     &I,U3I,U4I,U5I,U6I,U7I

C**   Read integration parameters from input file
      READ(20,7011,END=7100,ERR=7101) TINITIAL,TFINAL,INTEGSTP,PRINTINT,
     &ABSERR,RELERR
      CLOSE(UNIT=20)

C** Read torque parameters
      OPEN(UNIT=40, FILE='torque.in', STATUS='OLD')
      READ(40, 7200, ERR=7210) HETQP,KETQP,AETQP,HFTQP,KFTQP,AFTQP,METQP
     &,MFTQP
      CLOSE(UNIT=40)

C** Read activation parameters
      OPEN(UNIT=41, FILE='activation.in', STATUS='OLD')
      READ(41, 7300, ERR=7310) HEACTP,KEACTP,AEACTP,HFACTP,KFACTP,AFACTP
      CLOSE(UNIT=41)

C** Read spline coefficients for angles and HAT CoM location
      OPEN(UNIT=42, FILE='angles_coef.csv', STATUS='OLD')
      READ(42,*) NROW
      READ(42,*) (TT(I), I=1, NROW)
      READ(42,*) ((CCHIP(J,I), J=1, 6), I=1, NROW)
      READ(42,*) ((CCKNEE(J,I), J=1, 6), I=1, NROW)
      CLOSE(UNIT=42)
      OPEN(UNIT=43, FILE='HAT_coef.csv', STATUS='OLD')
      READ(43,*)
      READ(43,*)
      READ(43,*) ((CCHAT(J,I), J=1, 6), I=1, NROW)
      CLOSE(UNIT=43)

C** Read matching data
      OPEN(UNIT=44, FILE='matchingData2.csv', STATUS='OLD')
      READ(44,*) NROW, NCOL
      READ(44,*)
      READ(44,*, ERR=7410) ((Y(I,J), J=1, NCOL), I=1, NROW)
      CLOSE(UNIT=44)
      AERIALTIME = 0.132D0
      SWINGTIME  = 0.374D0

C**   Convert to generalised coordinates
      CALL INITCOND()


      X(1:7)   = HEACTP
      X(8:14)  = KEACTP
      X(15:21) = AEACTP
      X(22:28) = HFACTP
      X(29:35) = KFACTP
      X(36:42) = AFACTP
      X(43) = K1
      X(44) = K2
      X(45) = K3
      X(46) = K4
      X(47) = K5
      X(48) = K6
      X(49) = K7
      X(50) = K8

      
      DO I = 1, 100
      CALL FCN(N,X,COST)
      PRINT*, COST
      ENDDO

      STOP
7000  FORMAT(//,99A1,///)
7010  FORMAT( 1000(59X,E30.0,/) )
7011  FORMAT( 3(59X,E30.0,/), 1(59X,I30,/), 2(59X,E30.0,/) )
      STOP
7100  WRITE(*,*) 'Premature end of file while reading 6segsprint.in '
7101  WRITE(*,*) 'Error while reading file 6segsprint.in'
      STOP
7200  FORMAT(//, 8(///, 10(8X, F7.2, /)))
7210  WRITE(*,*) 'Error reading torque parameters'
      STOP
7300  FORMAT(//, 6(///, 7(5X, G30.10, /)))
7310  WRITE(*,*) 'Error reading activation parameters'
7410  WRITE(*,*) 'Error while reading matching data'
      STOP
      END PROGRAM MAIN

C***********************************************************************
      SUBROUTINE FCN(N,X,COST)
C Simulates the model with input parameters then calculates cost
C
C Inputs:
C    - N: number of parameters to optimise
C    - X: input parameters
C
C Outputs:
C    - COST:   cost function for given parameters
C
C***********************************************************************
      IMPLICIT DOUBLE PRECISION (A - Z)
      INTEGER          N,IDX,NACTP,NROW
      LOGICAL          EXIT
      PARAMETER        (NACTP=7)
      EXTERNAL         EQNS1
      DIMENSION        VAR(14)
      DIMENSION        X(N),Y(500,11)
      DIMENSION        TT(500),CCHIP(6,500),CCKNEE(6,500),CCHAT(6,500)
      DIMENSION        HETQP(10),HFTQP(10),KETQP(10),KFTQP(10),AETQP(10)
     &,AFTQP(10),HEACTP(NACTP),HFACTP(NACTP),KEACTP(NACTP),KFACTP(NACTP)
     &,AEACTP(NACTP),AFACTP(NACTP),METQP(10),MFTQP(10)
      COMMON/CONSTNTS/ FOOTANG,G,IA,IB,IC,ID,IE,IF,IG,K1,K2,K3,K4,K5,K6,
     &K7,K8,L1,L10,L11,L2,L3,L4,L5,L6,L7,L8,L9,MA,MB,MC,MD,ME,MF,MG
      COMMON/INITIAL / Q1I,Q2I,Q3I,Q4I,Q5I,Q6I,Q7I,U1I,U2I,U3I,U4I,U5I,U
     &6I,U7I
      COMMON/VARIBLES/ Q1,Q2,Q3,Q4,Q5,Q6,Q7,U1,U2,U3,U4,U5,U6,U7
      COMMON/ALGBRAIC/ AANG,AANGVEL,AETOR,AFTOR,ATOR,COP,GRF,HANG,HANGVE
     &L,HETOR,HFTOR,HTOR,HZ,KANG,KANGVEL,KECM,KETOR,KFTOR,KTOR,MANG,MANG
     &VEL,METOR,MFTOR,MTOR,PECM,PX,PY,RX,RX1,RX2,RY,RY1,RY2,SHANG,SHANGV
     &EL,SHTOR,SKANG,SKANGVEL,SKTOR,TE,U8,U9,Q1p,Q2p,Q3p,Q4p,Q5p,Q6p,Q7p
     &,U1p,U2p,U3p,U4p,U5p,U6p,U7p,AEACT,AECCANG,AECCANGVEL,AESECANG,AES
     &ECANGVEL,AFACT,AFCCANG,AFCCANGVEL,AFSECANG,AFSECANGVEL,EA,FA,GS,HE
     &ACT,HECCANG,HECCANGVEL,HESECANG,HESECANGVEL,HFACT,HFCCANG,HFCCANGV
     &EL,HFSECANG,HFSECANGVEL,KEACT,KECCANG,KECCANGVEL,KESECANG,KESECANG
     &VEL,KFACT,KFCCANG,KFCCANGVEL,KFSECANG,KFSECANGVEL,MEACT,MECCANG,ME
     &CCANGVEL,MESECANG,MESECANGVEL,MFACT,MFCCANG,MFCCANGVEL,MFSECANG,MF
     &SECANGVEL,EAp,FAp,GSp,EApp,FApp,GSpp,MT,POCMSTANCEX,POCMSTANCEY,PO
     &CMSWINGX,POCMSWINGY,POCMX,POCMY,POGOX,POGOY,POP1X,POP1Y,POP2X,POP2
     &Y,POP3X,POP3Y,POP4X,POP4Y,POP5X,POP5Y,POP6X,POP6Y,POP7X,POP7Y,POP8
     &X,POP8Y,POP9X,POP9Y,VOCMX,VOCMY,VOP2X,VOP2Y
      COMMON/MISCLLNS/ PI,DEGtoRAD,RADtoDEG,COEF(7,7),RHS(7)
      COMMON/INTEG   / TINITIAL,TFINAL,INTEGSTP,ABSERR,RELERR,PRINTINT
      COMMON/TQPARAMS/ HETQP,HFTQP,KETQP,KFTQP,AETQP,AFTQP,METQP,MFTQP
      COMMON/ACTPARAM/ HEACTP,HFACTP,KEACTP,KFACTP,AEACTP,AFACTP
      COMMON/SPLNCOEF/ TT,CCHIP,CCKNEE,CCHAT,NROW
      COMMON/DATAIN  / Y,AERIALTIME,SWINGTIME

C** Initialise parameters
      HEACTP = X(1:7)
      KEACTP = X(8:14)
      AEACTP = X(15:21)
      HFACTP = X(22:28)
      KFACTP = X(29:35)
      AFACTP = X(36:42)
      K1 = X(43)
      K2 = X(44)
      K3 = X(45)
      K4 = X(46)
      K5 = X(47)
      K6 = X(48)
      K7 = X(49)
      K8 = X(50)

C** Initialise variables
      Q1 = Q1I
      Q2 = Q2I
      Q3 = Q3I
      Q4 = Q4I
      Q5 = Q5I
      Q6 = Q6I
      Q7 = Q7I
      U1 = U1I
      U2 = U2I
      U3 = U3I
      U4 = U4I
      U5 = U5I
      U6 = U6I 
      U7 = U7I

C**   Initialize time, print counter, variables array for integrator
      EXIT = .FALSE.
      T      = TINITIAL
      VAR(1) = Q1
      VAR(2) = Q2
      VAR(3) = Q3
      VAR(4) = Q4
      VAR(5) = Q5
      VAR(6) = Q6
      VAR(7) = Q7
      VAR(8) = U1
      VAR(9) = U2
      VAR(10) = U3
      VAR(11) = U4
      VAR(12) = U5
      VAR(13) = U6
      VAR(14) = U7

C** Initialise variables for COST
      IDX = 2
      CALL EVALSPLINE2(TINITIAL,NROW,TT,CCHAT,GS,GSp,GSpp)
      CALL EVALSPLINE2(TINITIAL,NROW,TT,CCHIP,EA,EAp,EApp)
      CALL EVALSPLINE2(TINITIAL,NROW,TT,CCKNEE,FA,FAp,FApp)
      EA   = EA  *DEGtoRAD 
      EAp  = EAp *DEGtoRAD 
      EApp = EApp*DEGtoRAD 
      FA   = FA  *DEGtoRAD 
      FAp  = FAp *DEGtoRAD 
      FApp = FApp*DEGtoRAD 

      HATS = 0.0D0
      HIPS = 0.0D0
      KNEES = 0.0D0
      ANKLES  = 0.0D0
      MTPS = 0.0D0

C** Initialise torques for integration
      CALL UPDATE(T)

C**   Initalize numerical integrator with call to EQNS1 at T=TINITIAL
      CALL KUTTA(EQNS1, 12, VAR, T, INTEGSTP, ABSERR, RELERR, 0, *5920)

C**   Check exit conditions
5900  IF(TFINAL.GE.TINITIAL.AND.T+.01D0*INTEGSTP.GE.TFINAL) EXIT=.TRUE.
      IF(TFINAL.LE.TINITIAL.AND.T+.01D0*INTEGSTP.LE.TFINAL) EXIT=.TRUE.
      IF (Q2 .GT. 0.0D0) EXIT = .TRUE.

      IF (EXIT) THEN
        IDX = IDX - 1
        HATJ   = HATS   / IDX
        HIPJ   = HIPS   / IDX
        KNEEJ  = KNEES  / IDX
        ANKLEJ = ANKLES / IDX
        MTPJ   = MTPS   / IDX
        COST = 10*HATJ+HIPJ+KNEEJ+ANKLEJ+MTPJ
        RETURN
      ENDIF

C** Integrate      
      CALL KUTTA(EQNS1, 14, VAR, T, INTEGSTP, ABSERR, RELERR, 1, *5920)

C** Update torques after integration
      CALL UPDATE(T)

C** Intermediate cost      
      HATS   = HATS   + (Y(IDX,3)  - Q3*RADtoDEG)**2
      HIPS   = HIPS   + (Y(IDX,5)  - HANG*RADtoDEG)**2
      KNEES  = KNEES  + (Y(IDX,7)  - KANG*RADtoDEG)**2
      ANKLES = ANKLES + (Y(IDX,9)  - AANG*RADtoDEG)**2
      MTPS   = MTPS   + (Y(IDX,11) - MANG*RADtoDEG)**2
      IDX = IDX + 1
      GOTO 5900


C**   Print message if numerical integration fails to converge
5920  COST = 20000.0D0

      END SUBROUTINE FCN

C**********************************************************************
      SUBROUTINE       EQNS1(T, VAR, VARp, BOUNDARY)
      IMPLICIT         DOUBLE PRECISION (A - Z)
      INTEGER          BOUNDARY,NROW
      DIMENSION        VAR(*), VARp(*)
      DIMENSION        TT(500),CCHIP(6,500),CCKNEE(6,500),CCHAT(6,500)
      COMMON/CONSTNTS/ FOOTANG,G,IA,IB,IC,ID,IE,IF,IG,K1,K2,K3,K4,K5,K6,
     &K7,K8,L1,L10,L11,L2,L3,L4,L5,L6,L7,L8,L9,MA,MB,MC,MD,ME,MF,MG
      COMMON/VARIBLES/ Q1,Q2,Q3,Q4,Q5,Q6,Q7,U1,U2,U3,U4,U5,U6,U7
      COMMON/ALGBRAIC/ AANG,AANGVEL,AETOR,AFTOR,ATOR,COP,GRF,HANG,HANGVE
     &L,HETOR,HFTOR,HTOR,HZ,KANG,KANGVEL,KECM,KETOR,KFTOR,KTOR,MANG,MANG
     &VEL,METOR,MFTOR,MTOR,PECM,PX,PY,RX,RX1,RX2,RY,RY1,RY2,SHANG,SHANGV
     &EL,SHTOR,SKANG,SKANGVEL,SKTOR,TE,U8,U9,Q1p,Q2p,Q3p,Q4p,Q5p,Q6p,Q7p
     &,U1p,U2p,U3p,U4p,U5p,U6p,U7p,AEACT,AECCANG,AECCANGVEL,AESECANG,AES
     &ECANGVEL,AFACT,AFCCANG,AFCCANGVEL,AFSECANG,AFSECANGVEL,EA,FA,GS,HE
     &ACT,HECCANG,HECCANGVEL,HESECANG,HESECANGVEL,HFACT,HFCCANG,HFCCANGV
     &EL,HFSECANG,HFSECANGVEL,KEACT,KECCANG,KECCANGVEL,KESECANG,KESECANG
     &VEL,KFACT,KFCCANG,KFCCANGVEL,KFSECANG,KFSECANGVEL,MEACT,MECCANG,ME
     &CCANGVEL,MESECANG,MESECANGVEL,MFACT,MFCCANG,MFCCANGVEL,MFSECANG,MF
     &SECANGVEL,EAp,FAp,GSp,EApp,FApp,GSpp,MT,POCMSTANCEX,POCMSTANCEY,PO
     &CMSWINGX,POCMSWINGY,POCMX,POCMY,POGOX,POGOY,POP1X,POP1Y,POP2X,POP2
     &Y,POP3X,POP3Y,POP4X,POP4Y,POP5X,POP5Y,POP6X,POP6Y,POP7X,POP7Y,POP8
     &X,POP8Y,POP9X,POP9Y,VOCMX,VOCMY,VOP2X,VOP2Y
      COMMON/MISCLLNS/ PI,DEGtoRAD,RADtoDEG,COEF(7,7),RHS(7)
      COMMON/SPLNCOEF/ TT,CCHIP,CCKNEE,CCHAT,NROW

C**   Update variables after integration step
      Q1 = VAR(1)
      Q2 = VAR(2)
      Q3 = VAR(3)
      Q4 = VAR(4)
      Q5 = VAR(5)
      Q6 = VAR(6)
      Q7 = VAR(7)
      U1 = VAR(8)
      U2 = VAR(9)
      U3 = VAR(10)
      U4 = VAR(11)
      U5 = VAR(12)
      U6 = VAR(13)
      U7 = VAR(14)

      Q1p = U1
      Q2p = U2
      Q3p = U3
      Q4p = U4
      Q5p = U5
      Q6p = U6
      Q7p = U7

C** Calculate forces
      POP2X = Q1 - L2*COS(Q3-Q4-Q5-Q6-Q7)
      POP2Y = Q2 - L2*SIN(Q3-Q4-Q5-Q6-Q7)
      VOP2X = U1 + L2*SIN(Q3-Q4-Q5-Q6-Q7)*(U3-U4-U5-U6-U7)
      VOP2Y = U2 - L2*COS(Q3-Q4-Q5-Q6-Q7)*(U3-U4-U5-U6-U7)  

      IF (Q2 .LT. 0.0D0) THEN
        RY1 = -K3*Q2 - K4*ABS(Q2)*U2
        RX1 = (-K1*Q1 - K2*U1)*RY1
      ELSE
        RX1 = 0.0D0
        RY1 = 0.0D0
      ENDIF
      IF (POP2Y .LT. 0.0D0) THEN
        RY2 = -K3*POP2Y - K4*ABS(POP2Y)*VOP2Y
        RX2 = (-K1*POP2X - K2*VOP2X)*RY2
      ELSE
        RX2 = 0.0D0
        RY2 = 0.0D0
      ENDIF

C** Specified variables
      CALL EVALSPLINE2(T,NROW,TT,CCHAT,GS,GSp,GSpp)
      CALL EVALSPLINE2(T,NROW,TT,CCHIP,EA,EAp,EApp)
      CALL EVALSPLINE2(T,NROW,TT,CCKNEE,FA,FAp,FApp)
      EA   = EA  *DEGtoRAD 
      EAp  = EAp *DEGtoRAD 
      EApp = EApp*DEGtoRAD 
      FA   = FA  *DEGtoRAD 
      FAp  = FAp *DEGtoRAD 
      FApp = FApp*DEGtoRAD 


      COEF(1,1) = -MA - MB - MC - MD - ME - MF - MG
      COEF(1,2) = 0
      COEF(1,3) = MC*(L7*SIN(Q3-Q6-Q7)+L6*SIN(Q3-Q5-Q6-Q7)-L2*SIN(Q3-Q4-
     &Q5-Q6-Q7)) + 0.5D0*MB*(L4*SIN(Q3-Q5-Q6-Q7)+L3*SIN(FOOTANG+Q3-Q5-Q6
     &-Q7)-2*L2*SIN(Q3-Q4-Q5-Q6-Q7)) + MD*(L9*SIN(Q3-Q7)+L8*SIN(Q3-Q6-Q7
     &)+L6*SIN(Q3-Q5-Q6-Q7)-L2*SIN(Q3-Q4-Q5-Q6-Q7)) + MG*(GS*SIN(Q3)+L10
     &*SIN(Q3-Q7)+L8*SIN(Q3-Q6-Q7)+L6*SIN(Q3-Q5-Q6-Q7)-L2*SIN(Q3-Q4-Q5-Q
     &6-Q7)) + ME*(L10*SIN(Q3-Q7)+L8*SIN(Q3-Q6-Q7)+L6*SIN(Q3-Q5-Q6-Q7)-(
     &L10-L9)*SIN(EA-Q3)-L2*SIN(Q3-Q4-Q5-Q6-Q7)) + MF*(L10*SIN(Q3-Q7)+L8
     &*SIN(Q3-Q6-Q7)+L6*SIN(Q3-Q5-Q6-Q7)-L10*SIN(EA-Q3)-(L7-L8)*SIN(EA-F
     &A-Q3)-L2*SIN(Q3-Q4-Q5-Q6-Q7)) - L1*MA*SIN(Q3-Q4-Q5-Q6-Q7)
      COEF(1,4) = (L1*MA+L2*MB+L2*MC+L2*MD+L2*ME+L2*MF+L2*MG)*SIN(Q3-Q4-
     &Q5-Q6-Q7)
      COEF(1,5) = L1*MA*SIN(Q3-Q4-Q5-Q6-Q7) - MC*(L6*SIN(Q3-Q5-Q6-Q7)-L2
     &*SIN(Q3-Q4-Q5-Q6-Q7)) - MD*(L6*SIN(Q3-Q5-Q6-Q7)-L2*SIN(Q3-Q4-Q5-Q6
     &-Q7)) - ME*(L6*SIN(Q3-Q5-Q6-Q7)-L2*SIN(Q3-Q4-Q5-Q6-Q7)) - MF*(L6*S
     &IN(Q3-Q5-Q6-Q7)-L2*SIN(Q3-Q4-Q5-Q6-Q7)) - MG*(L6*SIN(Q3-Q5-Q6-Q7)-
     &L2*SIN(Q3-Q4-Q5-Q6-Q7)) - 0.5D0*MB*(L4*SIN(Q3-Q5-Q6-Q7)+L3*SIN(FOO
     &TANG+Q3-Q5-Q6-Q7)-2*L2*SIN(Q3-Q4-Q5-Q6-Q7))
      COEF(1,6) = L1*MA*SIN(Q3-Q4-Q5-Q6-Q7) - MC*(L7*SIN(Q3-Q6-Q7)+L6*SI
     &N(Q3-Q5-Q6-Q7)-L2*SIN(Q3-Q4-Q5-Q6-Q7)) - MD*(L8*SIN(Q3-Q6-Q7)+L6*S
     &IN(Q3-Q5-Q6-Q7)-L2*SIN(Q3-Q4-Q5-Q6-Q7)) - ME*(L8*SIN(Q3-Q6-Q7)+L6*
     &SIN(Q3-Q5-Q6-Q7)-L2*SIN(Q3-Q4-Q5-Q6-Q7)) - MF*(L8*SIN(Q3-Q6-Q7)+L6
     &*SIN(Q3-Q5-Q6-Q7)-L2*SIN(Q3-Q4-Q5-Q6-Q7)) - MG*(L8*SIN(Q3-Q6-Q7)+L
     &6*SIN(Q3-Q5-Q6-Q7)-L2*SIN(Q3-Q4-Q5-Q6-Q7)) - 0.5D0*MB*(L4*SIN(Q3-Q
     &5-Q6-Q7)+L3*SIN(FOOTANG+Q3-Q5-Q6-Q7)-2*L2*SIN(Q3-Q4-Q5-Q6-Q7))
      COEF(1,7) = L1*MA*SIN(Q3-Q4-Q5-Q6-Q7) - MC*(L7*SIN(Q3-Q6-Q7)+L6*SI
     &N(Q3-Q5-Q6-Q7)-L2*SIN(Q3-Q4-Q5-Q6-Q7)) - 0.5D0*MB*(L4*SIN(Q3-Q5-Q6
     &-Q7)+L3*SIN(FOOTANG+Q3-Q5-Q6-Q7)-2*L2*SIN(Q3-Q4-Q5-Q6-Q7)) - MD*(L
     &9*SIN(Q3-Q7)+L8*SIN(Q3-Q6-Q7)+L6*SIN(Q3-Q5-Q6-Q7)-L2*SIN(Q3-Q4-Q5-
     &Q6-Q7)) - ME*(L10*SIN(Q3-Q7)+L8*SIN(Q3-Q6-Q7)+L6*SIN(Q3-Q5-Q6-Q7)-
     &L2*SIN(Q3-Q4-Q5-Q6-Q7)) - MF*(L10*SIN(Q3-Q7)+L8*SIN(Q3-Q6-Q7)+L6*S
     &IN(Q3-Q5-Q6-Q7)-L2*SIN(Q3-Q4-Q5-Q6-Q7)) - MG*(L10*SIN(Q3-Q7)+L8*SI
     &N(Q3-Q6-Q7)+L6*SIN(Q3-Q5-Q6-Q7)-L2*SIN(Q3-Q4-Q5-Q6-Q7))
      COEF(2,1) = 0
      COEF(2,2) = -MA - MB - MC - MD - ME - MF - MG
      COEF(2,3) = L1*MA*COS(Q3-Q4-Q5-Q6-Q7) - MC*(L7*COS(Q3-Q6-Q7)+L6*CO
     &S(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4-Q5-Q6-Q7)) - 0.5D0*MB*(L4*COS(Q3-Q5-Q6
     &-Q7)+L3*COS(FOOTANG+Q3-Q5-Q6-Q7)-2*L2*COS(Q3-Q4-Q5-Q6-Q7)) - MD*(L
     &9*COS(Q3-Q7)+L8*COS(Q3-Q6-Q7)+L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4-Q5-
     &Q6-Q7)) - MG*(GS*COS(Q3)+L10*COS(Q3-Q7)+L8*COS(Q3-Q6-Q7)+L6*COS(Q3
     &-Q5-Q6-Q7)-L2*COS(Q3-Q4-Q5-Q6-Q7)) - ME*(L10*COS(Q3-Q7)+L8*COS(Q3-
     &Q6-Q7)+(L10-L9)*COS(EA-Q3)+L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4-Q5-Q6-
     &Q7)) - MF*(L10*COS(EA-Q3)+L10*COS(Q3-Q7)+L8*COS(Q3-Q6-Q7)+L6*COS(Q
     &3-Q5-Q6-Q7)+(L7-L8)*COS(EA-FA-Q3)-L2*COS(Q3-Q4-Q5-Q6-Q7))
      COEF(2,4) = -(L1*MA+L2*MB+L2*MC+L2*MD+L2*ME+L2*MF+L2*MG)*COS(Q3-Q4
     &-Q5-Q6-Q7)
      COEF(2,5) = MC*(L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4-Q5-Q6-Q7)) + MD*(
     &L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4-Q5-Q6-Q7)) + ME*(L6*COS(Q3-Q5-Q6-
     &Q7)-L2*COS(Q3-Q4-Q5-Q6-Q7)) + MF*(L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4
     &-Q5-Q6-Q7)) + MG*(L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4-Q5-Q6-Q7)) + 0.
     &5D0*MB*(L4*COS(Q3-Q5-Q6-Q7)+L3*COS(FOOTANG+Q3-Q5-Q6-Q7)-2*L2*COS(Q
     &3-Q4-Q5-Q6-Q7)) - L1*MA*COS(Q3-Q4-Q5-Q6-Q7)
      COEF(2,6) = MC*(L7*COS(Q3-Q6-Q7)+L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4-
     &Q5-Q6-Q7)) + MD*(L8*COS(Q3-Q6-Q7)+L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4
     &-Q5-Q6-Q7)) + ME*(L8*COS(Q3-Q6-Q7)+L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q
     &4-Q5-Q6-Q7)) + MF*(L8*COS(Q3-Q6-Q7)+L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3-
     &Q4-Q5-Q6-Q7)) + MG*(L8*COS(Q3-Q6-Q7)+L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3
     &-Q4-Q5-Q6-Q7)) + 0.5D0*MB*(L4*COS(Q3-Q5-Q6-Q7)+L3*COS(FOOTANG+Q3-Q
     &5-Q6-Q7)-2*L2*COS(Q3-Q4-Q5-Q6-Q7)) - L1*MA*COS(Q3-Q4-Q5-Q6-Q7)
      COEF(2,7) = MC*(L7*COS(Q3-Q6-Q7)+L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4-
     &Q5-Q6-Q7)) + 0.5D0*MB*(L4*COS(Q3-Q5-Q6-Q7)+L3*COS(FOOTANG+Q3-Q5-Q6
     &-Q7)-2*L2*COS(Q3-Q4-Q5-Q6-Q7)) + MD*(L9*COS(Q3-Q7)+L8*COS(Q3-Q6-Q7
     &)+L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4-Q5-Q6-Q7)) + ME*(L10*COS(Q3-Q7)
     &+L8*COS(Q3-Q6-Q7)+L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4-Q5-Q6-Q7)) + MF
     &*(L10*COS(Q3-Q7)+L8*COS(Q3-Q6-Q7)+L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4
     &-Q5-Q6-Q7)) + MG*(L10*COS(Q3-Q7)+L8*COS(Q3-Q6-Q7)+L6*COS(Q3-Q5-Q6-
     &Q7)-L2*COS(Q3-Q4-Q5-Q6-Q7)) - L1*MA*COS(Q3-Q4-Q5-Q6-Q7)
      COEF(3,1) = MC*(L7*SIN(Q3-Q6-Q7)+L6*SIN(Q3-Q5-Q6-Q7)-L2*SIN(Q3-Q4-
     &Q5-Q6-Q7)) + 0.5D0*MB*(L4*SIN(Q3-Q5-Q6-Q7)+L3*SIN(FOOTANG+Q3-Q5-Q6
     &-Q7)-2*L2*SIN(Q3-Q4-Q5-Q6-Q7)) + MD*(L9*SIN(Q3-Q7)+L8*SIN(Q3-Q6-Q7
     &)+L6*SIN(Q3-Q5-Q6-Q7)-L2*SIN(Q3-Q4-Q5-Q6-Q7)) + MG*(GS*SIN(Q3)+L10
     &*SIN(Q3-Q7)+L8*SIN(Q3-Q6-Q7)+L6*SIN(Q3-Q5-Q6-Q7)-L2*SIN(Q3-Q4-Q5-Q
     &6-Q7)) + ME*(L10*SIN(Q3-Q7)+L8*SIN(Q3-Q6-Q7)+L6*SIN(Q3-Q5-Q6-Q7)-(
     &L10-L9)*SIN(EA-Q3)-L2*SIN(Q3-Q4-Q5-Q6-Q7)) + MF*(L10*SIN(Q3-Q7)+L8
     &*SIN(Q3-Q6-Q7)+L6*SIN(Q3-Q5-Q6-Q7)-L10*SIN(EA-Q3)-(L7-L8)*SIN(EA-F
     &A-Q3)-L2*SIN(Q3-Q4-Q5-Q6-Q7)) - L1*MA*SIN(Q3-Q4-Q5-Q6-Q7)
      COEF(3,2) = L1*MA*COS(Q3-Q4-Q5-Q6-Q7) - MC*(L7*COS(Q3-Q6-Q7)+L6*CO
     &S(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4-Q5-Q6-Q7)) - 0.5D0*MB*(L4*COS(Q3-Q5-Q6
     &-Q7)+L3*COS(FOOTANG+Q3-Q5-Q6-Q7)-2*L2*COS(Q3-Q4-Q5-Q6-Q7)) - MD*(L
     &9*COS(Q3-Q7)+L8*COS(Q3-Q6-Q7)+L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4-Q5-
     &Q6-Q7)) - MG*(GS*COS(Q3)+L10*COS(Q3-Q7)+L8*COS(Q3-Q6-Q7)+L6*COS(Q3
     &-Q5-Q6-Q7)-L2*COS(Q3-Q4-Q5-Q6-Q7)) - ME*(L10*COS(Q3-Q7)+L8*COS(Q3-
     &Q6-Q7)+(L10-L9)*COS(EA-Q3)+L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4-Q5-Q6-
     &Q7)) - MF*(L10*COS(EA-Q3)+L10*COS(Q3-Q7)+L8*COS(Q3-Q6-Q7)+L6*COS(Q
     &3-Q5-Q6-Q7)+(L7-L8)*COS(EA-FA-Q3)-L2*COS(Q3-Q4-Q5-Q6-Q7))
      COEF(3,3) = -IA - IB - IC - ID - IE - IF - IG - MA*L1**2 - MC*(L2*
     &*2+L6**2+L7**2+2*L6*L7*COS(Q5)-2*L2*L6*COS(Q4)-2*L2*L7*COS(Q4+Q5))
     & - 0.25D0*MB*(L3**2+L4**2+4*L2**2+2*L3*L4*COS(FOOTANG)-4*L2*L4*COS
     &(Q4)-4*L2*L3*COS(FOOTANG+Q4)) - MD*(L2**2+L6**2+L8**2+L9**2+2*L6*L
     &8*COS(Q5)+2*L8*L9*COS(Q6)+2*L6*L9*COS(Q5+Q6)-2*L2*L6*COS(Q4)-2*L2*
     &L8*COS(Q4+Q5)-2*L2*L9*COS(Q4+Q5+Q6)) - MG*(L10**2+L2**2+L6**2+L8**
     &2+GS**2+2*L10*L8*COS(Q6)+2*L10*GS*COS(Q7)+2*L6*L8*COS(Q5)+2*L10*L6
     &*COS(Q5+Q6)+2*L8*GS*COS(Q6+Q7)+2*L6*GS*COS(Q5+Q6+Q7)-2*L2*L6*COS(Q
     &4)-2*L2*L8*COS(Q4+Q5)-2*L10*L2*COS(Q4+Q5+Q6)-2*L2*GS*COS(Q4+Q5+Q6+
     &Q7)) - ME*(L10**2+L2**2+L6**2+L8**2+(L10-L9)**2+2*L10*L8*COS(Q6)+2
     &*L6*L8*COS(Q5)+2*L10*L6*COS(Q5+Q6)+2*L10*(L10-L9)*COS(EA-Q7)+2*L8*
     &(L10-L9)*COS(EA-Q6-Q7)+2*L6*(L10-L9)*COS(EA-Q5-Q6-Q7)-2*L2*L6*COS(
     &Q4)-2*L2*L8*COS(Q4+Q5)-2*L10*L2*COS(Q4+Q5+Q6)-2*L2*(L10-L9)*COS(EA
     &-Q4-Q5-Q6-Q7)) - MF*(L2**2+L6**2+L8**2+2*L10**2+(L7-L8)**2+2*L10*(
     &L7-L8)*COS(FA)+2*L10*L8*COS(Q6)+2*L6*L8*COS(Q5)+2*L10*L6*COS(Q5+Q6
     &)+2*L10**2*COS(EA-Q7)+2*L10*L8*COS(EA-Q6-Q7)+2*L10*L6*COS(EA-Q5-Q6
     &-Q7)+2*L10*(L7-L8)*COS(EA-FA-Q7)+2*L8*(L7-L8)*COS(EA-FA-Q6-Q7)+2*L
     &6*(L7-L8)*COS(EA-FA-Q5-Q6-Q7)-2*L2*L6*COS(Q4)-2*L2*L8*COS(Q4+Q5)-2
     &*L10*L2*COS(Q4+Q5+Q6)-2*L10*L2*COS(EA-Q4-Q5-Q6-Q7)-2*L2*(L7-L8)*CO
     &S(EA-FA-Q4-Q5-Q6-Q7))
      COEF(3,4) = IA + MA*L1**2 + L2*MC*(L2-L6*COS(Q4)-L7*COS(Q4+Q5)) + 
     &0.5D0*L2*MB*(2*L2-L4*COS(Q4)-L3*COS(FOOTANG+Q4)) + L2*MD*(L2-L6*CO
     &S(Q4)-L8*COS(Q4+Q5)-L9*COS(Q4+Q5+Q6)) + L2*MG*(L2-L6*COS(Q4)-L8*CO
     &S(Q4+Q5)-L10*COS(Q4+Q5+Q6)-GS*COS(Q4+Q5+Q6+Q7)) + L2*ME*(L2-L6*COS
     &(Q4)-L8*COS(Q4+Q5)-L10*COS(Q4+Q5+Q6)-(L10-L9)*COS(EA-Q4-Q5-Q6-Q7))
     & + L2*MF*(L2-L6*COS(Q4)-L8*COS(Q4+Q5)-L10*COS(Q4+Q5+Q6)-L10*COS(EA
     &-Q4-Q5-Q6-Q7)-(L7-L8)*COS(EA-FA-Q4-Q5-Q6-Q7))
      COEF(3,5) = IA + IB + MA*L1**2 + MC*(L2**2+L6**2+L6*L7*COS(Q5)-2*L
     &2*L6*COS(Q4)-L2*L7*COS(Q4+Q5)) + 0.25D0*MB*(L3**2+L4**2+4*L2**2+2*
     &L3*L4*COS(FOOTANG)-4*L2*L4*COS(Q4)-4*L2*L3*COS(FOOTANG+Q4)) + MD*(
     &L2**2+L6**2+L6*L8*COS(Q5)+L6*L9*COS(Q5+Q6)-2*L2*L6*COS(Q4)-L2*L8*C
     &OS(Q4+Q5)-L2*L9*COS(Q4+Q5+Q6)) + MG*(L2**2+L6**2+L6*L8*COS(Q5)+L10
     &*L6*COS(Q5+Q6)+L6*GS*COS(Q5+Q6+Q7)-2*L2*L6*COS(Q4)-L2*L8*COS(Q4+Q5
     &)-L10*L2*COS(Q4+Q5+Q6)-L2*GS*COS(Q4+Q5+Q6+Q7)) + ME*(L2**2+L6**2+L
     &6*L8*COS(Q5)+L10*L6*COS(Q5+Q6)+L6*(L10-L9)*COS(EA-Q5-Q6-Q7)-2*L2*L
     &6*COS(Q4)-L2*L8*COS(Q4+Q5)-L10*L2*COS(Q4+Q5+Q6)-L2*(L10-L9)*COS(EA
     &-Q4-Q5-Q6-Q7)) + MF*(L2**2+L6**2+L6*L8*COS(Q5)+L10*L6*COS(Q5+Q6)+L
     &10*L6*COS(EA-Q5-Q6-Q7)+L6*(L7-L8)*COS(EA-FA-Q5-Q6-Q7)-2*L2*L6*COS(
     &Q4)-L2*L8*COS(Q4+Q5)-L10*L2*COS(Q4+Q5+Q6)-L10*L2*COS(EA-Q4-Q5-Q6-Q
     &7)-L2*(L7-L8)*COS(EA-FA-Q4-Q5-Q6-Q7))
      COEF(3,6) = IA + IB + IC + MA*L1**2 + MC*(L2**2+L6**2+L7**2+2*L6*L
     &7*COS(Q5)-2*L2*L6*COS(Q4)-2*L2*L7*COS(Q4+Q5)) + 0.25D0*MB*(L3**2+L
     &4**2+4*L2**2+2*L3*L4*COS(FOOTANG)-4*L2*L4*COS(Q4)-4*L2*L3*COS(FOOT
     &ANG+Q4)) + MD*(L2**2+L6**2+L8**2+L8*L9*COS(Q6)+2*L6*L8*COS(Q5)+L6*
     &L9*COS(Q5+Q6)-2*L2*L6*COS(Q4)-2*L2*L8*COS(Q4+Q5)-L2*L9*COS(Q4+Q5+Q
     &6)) + MG*(L2**2+L6**2+L8**2+L10*L8*COS(Q6)+2*L6*L8*COS(Q5)+L10*L6*
     &COS(Q5+Q6)+L8*GS*COS(Q6+Q7)+L6*GS*COS(Q5+Q6+Q7)-2*L2*L6*COS(Q4)-2*
     &L2*L8*COS(Q4+Q5)-L10*L2*COS(Q4+Q5+Q6)-L2*GS*COS(Q4+Q5+Q6+Q7)) + ME
     &*(L2**2+L6**2+L8**2+L10*L8*COS(Q6)+2*L6*L8*COS(Q5)+L10*L6*COS(Q5+Q
     &6)+L8*(L10-L9)*COS(EA-Q6-Q7)+L6*(L10-L9)*COS(EA-Q5-Q6-Q7)-2*L2*L6*
     &COS(Q4)-2*L2*L8*COS(Q4+Q5)-L10*L2*COS(Q4+Q5+Q6)-L2*(L10-L9)*COS(EA
     &-Q4-Q5-Q6-Q7)) + MF*(L2**2+L6**2+L8**2+L10*L8*COS(Q6)+2*L6*L8*COS(
     &Q5)+L10*L6*COS(Q5+Q6)+L10*L8*COS(EA-Q6-Q7)+L10*L6*COS(EA-Q5-Q6-Q7)
     &+L8*(L7-L8)*COS(EA-FA-Q6-Q7)+L6*(L7-L8)*COS(EA-FA-Q5-Q6-Q7)-2*L2*L
     &6*COS(Q4)-2*L2*L8*COS(Q4+Q5)-L10*L2*COS(Q4+Q5+Q6)-L10*L2*COS(EA-Q4
     &-Q5-Q6-Q7)-L2*(L7-L8)*COS(EA-FA-Q4-Q5-Q6-Q7))
      COEF(3,7) = IA + IB + IC + ID + MA*L1**2 + MC*(L2**2+L6**2+L7**2+2
     &*L6*L7*COS(Q5)-2*L2*L6*COS(Q4)-2*L2*L7*COS(Q4+Q5)) + 0.25D0*MB*(L3
     &**2+L4**2+4*L2**2+2*L3*L4*COS(FOOTANG)-4*L2*L4*COS(Q4)-4*L2*L3*COS
     &(FOOTANG+Q4)) + MD*(L2**2+L6**2+L8**2+L9**2+2*L6*L8*COS(Q5)+2*L8*L
     &9*COS(Q6)+2*L6*L9*COS(Q5+Q6)-2*L2*L6*COS(Q4)-2*L2*L8*COS(Q4+Q5)-2*
     &L2*L9*COS(Q4+Q5+Q6)) + MG*(L10**2+L2**2+L6**2+L8**2+L10*GS*COS(Q7)
     &+2*L10*L8*COS(Q6)+2*L6*L8*COS(Q5)+L8*GS*COS(Q6+Q7)+2*L10*L6*COS(Q5
     &+Q6)+L6*GS*COS(Q5+Q6+Q7)-2*L2*L6*COS(Q4)-2*L2*L8*COS(Q4+Q5)-2*L10*
     &L2*COS(Q4+Q5+Q6)-L2*GS*COS(Q4+Q5+Q6+Q7)) + ME*(L10**2+L2**2+L6**2+
     &L8**2+2*L10*L8*COS(Q6)+2*L6*L8*COS(Q5)+2*L10*L6*COS(Q5+Q6)+L10*(L1
     &0-L9)*COS(EA-Q7)+L8*(L10-L9)*COS(EA-Q6-Q7)+L6*(L10-L9)*COS(EA-Q5-Q
     &6-Q7)-2*L2*L6*COS(Q4)-2*L2*L8*COS(Q4+Q5)-2*L10*L2*COS(Q4+Q5+Q6)-L2
     &*(L10-L9)*COS(EA-Q4-Q5-Q6-Q7)) + MF*(L10**2+L2**2+L6**2+L8**2+2*L1
     &0*L8*COS(Q6)+2*L6*L8*COS(Q5)+2*L10*L6*COS(Q5+Q6)+L10**2*COS(EA-Q7)
     &+L10*L8*COS(EA-Q6-Q7)+L10*L6*COS(EA-Q5-Q6-Q7)+L10*(L7-L8)*COS(EA-F
     &A-Q7)+L8*(L7-L8)*COS(EA-FA-Q6-Q7)+L6*(L7-L8)*COS(EA-FA-Q5-Q6-Q7)-2
     &*L2*L6*COS(Q4)-2*L2*L8*COS(Q4+Q5)-2*L10*L2*COS(Q4+Q5+Q6)-L10*L2*CO
     &S(EA-Q4-Q5-Q6-Q7)-L2*(L7-L8)*COS(EA-FA-Q4-Q5-Q6-Q7))
      COEF(4,1) = (L1*MA+L2*MB+L2*MC+L2*MD+L2*ME+L2*MF+L2*MG)*SIN(Q3-Q4-
     &Q5-Q6-Q7)
      COEF(4,2) = -(L1*MA+L2*MB+L2*MC+L2*MD+L2*ME+L2*MF+L2*MG)*COS(Q3-Q4
     &-Q5-Q6-Q7)
      COEF(4,3) = IA + MA*L1**2 + L2*MC*(L2-L6*COS(Q4)-L7*COS(Q4+Q5)) + 
     &0.5D0*L2*MB*(2*L2-L4*COS(Q4)-L3*COS(FOOTANG+Q4)) + L2*MD*(L2-L6*CO
     &S(Q4)-L8*COS(Q4+Q5)-L9*COS(Q4+Q5+Q6)) + L2*MG*(L2-L6*COS(Q4)-L8*CO
     &S(Q4+Q5)-L10*COS(Q4+Q5+Q6)-GS*COS(Q4+Q5+Q6+Q7)) + L2*ME*(L2-L6*COS
     &(Q4)-L8*COS(Q4+Q5)-L10*COS(Q4+Q5+Q6)-(L10-L9)*COS(EA-Q4-Q5-Q6-Q7))
     & + L2*MF*(L2-L6*COS(Q4)-L8*COS(Q4+Q5)-L10*COS(Q4+Q5+Q6)-L10*COS(EA
     &-Q4-Q5-Q6-Q7)-(L7-L8)*COS(EA-FA-Q4-Q5-Q6-Q7))
      COEF(4,4) = -IA - MA*L1**2 - MB*L2**2 - MC*L2**2 - MD*L2**2 - ME*L
     &2**2 - MF*L2**2 - MG*L2**2
      COEF(4,5) = -IA - MA*L1**2 - L2*MC*(L2-L6*COS(Q4)) - L2*MD*(L2-L6*
     &COS(Q4)) - L2*ME*(L2-L6*COS(Q4)) - L2*MF*(L2-L6*COS(Q4)) - L2*MG*(
     &L2-L6*COS(Q4)) - 0.5D0*L2*MB*(2*L2-L4*COS(Q4)-L3*COS(FOOTANG+Q4))
      COEF(4,6) = -IA - MA*L1**2 - L2*MC*(L2-L6*COS(Q4)-L7*COS(Q4+Q5)) -
     & L2*MD*(L2-L6*COS(Q4)-L8*COS(Q4+Q5)) - L2*ME*(L2-L6*COS(Q4)-L8*COS
     &(Q4+Q5)) - L2*MF*(L2-L6*COS(Q4)-L8*COS(Q4+Q5)) - L2*MG*(L2-L6*COS(
     &Q4)-L8*COS(Q4+Q5)) - 0.5D0*L2*MB*(2*L2-L4*COS(Q4)-L3*COS(FOOTANG+Q
     &4))
      COEF(4,7) = -IA - MA*L1**2 - L2*MC*(L2-L6*COS(Q4)-L7*COS(Q4+Q5)) -
     & 0.5D0*L2*MB*(2*L2-L4*COS(Q4)-L3*COS(FOOTANG+Q4)) - L2*MD*(L2-L6*C
     &OS(Q4)-L8*COS(Q4+Q5)-L9*COS(Q4+Q5+Q6)) - L2*ME*(L2-L6*COS(Q4)-L8*C
     &OS(Q4+Q5)-L10*COS(Q4+Q5+Q6)) - L2*MF*(L2-L6*COS(Q4)-L8*COS(Q4+Q5)-
     &L10*COS(Q4+Q5+Q6)) - L2*MG*(L2-L6*COS(Q4)-L8*COS(Q4+Q5)-L10*COS(Q4
     &+Q5+Q6))
      COEF(5,1) = L1*MA*SIN(Q3-Q4-Q5-Q6-Q7) - MC*(L6*SIN(Q3-Q5-Q6-Q7)-L2
     &*SIN(Q3-Q4-Q5-Q6-Q7)) - MD*(L6*SIN(Q3-Q5-Q6-Q7)-L2*SIN(Q3-Q4-Q5-Q6
     &-Q7)) - ME*(L6*SIN(Q3-Q5-Q6-Q7)-L2*SIN(Q3-Q4-Q5-Q6-Q7)) - MF*(L6*S
     &IN(Q3-Q5-Q6-Q7)-L2*SIN(Q3-Q4-Q5-Q6-Q7)) - MG*(L6*SIN(Q3-Q5-Q6-Q7)-
     &L2*SIN(Q3-Q4-Q5-Q6-Q7)) - 0.5D0*MB*(L4*SIN(Q3-Q5-Q6-Q7)+L3*SIN(FOO
     &TANG+Q3-Q5-Q6-Q7)-2*L2*SIN(Q3-Q4-Q5-Q6-Q7))
      COEF(5,2) = MC*(L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4-Q5-Q6-Q7)) + MD*(
     &L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4-Q5-Q6-Q7)) + ME*(L6*COS(Q3-Q5-Q6-
     &Q7)-L2*COS(Q3-Q4-Q5-Q6-Q7)) + MF*(L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4
     &-Q5-Q6-Q7)) + MG*(L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4-Q5-Q6-Q7)) + 0.
     &5D0*MB*(L4*COS(Q3-Q5-Q6-Q7)+L3*COS(FOOTANG+Q3-Q5-Q6-Q7)-2*L2*COS(Q
     &3-Q4-Q5-Q6-Q7)) - L1*MA*COS(Q3-Q4-Q5-Q6-Q7)
      COEF(5,3) = IA + IB + MA*L1**2 + MC*(L2**2+L6**2+L6*L7*COS(Q5)-2*L
     &2*L6*COS(Q4)-L2*L7*COS(Q4+Q5)) + 0.25D0*MB*(L3**2+L4**2+4*L2**2+2*
     &L3*L4*COS(FOOTANG)-4*L2*L4*COS(Q4)-4*L2*L3*COS(FOOTANG+Q4)) + MD*(
     &L2**2+L6**2+L6*L8*COS(Q5)+L6*L9*COS(Q5+Q6)-2*L2*L6*COS(Q4)-L2*L8*C
     &OS(Q4+Q5)-L2*L9*COS(Q4+Q5+Q6)) + MG*(L2**2+L6**2+L6*L8*COS(Q5)+L10
     &*L6*COS(Q5+Q6)+L6*GS*COS(Q5+Q6+Q7)-2*L2*L6*COS(Q4)-L2*L8*COS(Q4+Q5
     &)-L10*L2*COS(Q4+Q5+Q6)-L2*GS*COS(Q4+Q5+Q6+Q7)) + ME*(L2**2+L6**2+L
     &6*L8*COS(Q5)+L10*L6*COS(Q5+Q6)+L6*(L10-L9)*COS(EA-Q5-Q6-Q7)-2*L2*L
     &6*COS(Q4)-L2*L8*COS(Q4+Q5)-L10*L2*COS(Q4+Q5+Q6)-L2*(L10-L9)*COS(EA
     &-Q4-Q5-Q6-Q7)) + MF*(L2**2+L6**2+L6*L8*COS(Q5)+L10*L6*COS(Q5+Q6)+L
     &10*L6*COS(EA-Q5-Q6-Q7)+L6*(L7-L8)*COS(EA-FA-Q5-Q6-Q7)-2*L2*L6*COS(
     &Q4)-L2*L8*COS(Q4+Q5)-L10*L2*COS(Q4+Q5+Q6)-L10*L2*COS(EA-Q4-Q5-Q6-Q
     &7)-L2*(L7-L8)*COS(EA-FA-Q4-Q5-Q6-Q7))
      COEF(5,4) = -IA - MA*L1**2 - L2*MC*(L2-L6*COS(Q4)) - L2*MD*(L2-L6*
     &COS(Q4)) - L2*ME*(L2-L6*COS(Q4)) - L2*MF*(L2-L6*COS(Q4)) - L2*MG*(
     &L2-L6*COS(Q4)) - 0.5D0*L2*MB*(2*L2-L4*COS(Q4)-L3*COS(FOOTANG+Q4))
      COEF(5,5) = -IA - IB - MA*L1**2 - MC*(L2**2+L6**2-2*L2*L6*COS(Q4))
     & - MD*(L2**2+L6**2-2*L2*L6*COS(Q4)) - ME*(L2**2+L6**2-2*L2*L6*COS(
     &Q4)) - MF*(L2**2+L6**2-2*L2*L6*COS(Q4)) - MG*(L2**2+L6**2-2*L2*L6*
     &COS(Q4)) - 0.25D0*MB*(L3**2+L4**2+4*L2**2+2*L3*L4*COS(FOOTANG)-4*L
     &2*L4*COS(Q4)-4*L2*L3*COS(FOOTANG+Q4))
      COEF(5,6) = -IA - IB - MA*L1**2 - MC*(L2**2+L6**2+L6*L7*COS(Q5)-2*
     &L2*L6*COS(Q4)-L2*L7*COS(Q4+Q5)) - MD*(L2**2+L6**2+L6*L8*COS(Q5)-2*
     &L2*L6*COS(Q4)-L2*L8*COS(Q4+Q5)) - ME*(L2**2+L6**2+L6*L8*COS(Q5)-2*
     &L2*L6*COS(Q4)-L2*L8*COS(Q4+Q5)) - MF*(L2**2+L6**2+L6*L8*COS(Q5)-2*
     &L2*L6*COS(Q4)-L2*L8*COS(Q4+Q5)) - MG*(L2**2+L6**2+L6*L8*COS(Q5)-2*
     &L2*L6*COS(Q4)-L2*L8*COS(Q4+Q5)) - 0.25D0*MB*(L3**2+L4**2+4*L2**2+2
     &*L3*L4*COS(FOOTANG)-4*L2*L4*COS(Q4)-4*L2*L3*COS(FOOTANG+Q4))
      COEF(5,7) = -IA - IB - MA*L1**2 - MC*(L2**2+L6**2+L6*L7*COS(Q5)-2*
     &L2*L6*COS(Q4)-L2*L7*COS(Q4+Q5)) - 0.25D0*MB*(L3**2+L4**2+4*L2**2+2
     &*L3*L4*COS(FOOTANG)-4*L2*L4*COS(Q4)-4*L2*L3*COS(FOOTANG+Q4)) - MD*
     &(L2**2+L6**2+L6*L8*COS(Q5)+L6*L9*COS(Q5+Q6)-2*L2*L6*COS(Q4)-L2*L8*
     &COS(Q4+Q5)-L2*L9*COS(Q4+Q5+Q6)) - ME*(L2**2+L6**2+L6*L8*COS(Q5)+L1
     &0*L6*COS(Q5+Q6)-2*L2*L6*COS(Q4)-L2*L8*COS(Q4+Q5)-L10*L2*COS(Q4+Q5+
     &Q6)) - MF*(L2**2+L6**2+L6*L8*COS(Q5)+L10*L6*COS(Q5+Q6)-2*L2*L6*COS
     &(Q4)-L2*L8*COS(Q4+Q5)-L10*L2*COS(Q4+Q5+Q6)) - MG*(L2**2+L6**2+L6*L
     &8*COS(Q5)+L10*L6*COS(Q5+Q6)-2*L2*L6*COS(Q4)-L2*L8*COS(Q4+Q5)-L10*L
     &2*COS(Q4+Q5+Q6))
      COEF(6,1) = L1*MA*SIN(Q3-Q4-Q5-Q6-Q7) - MC*(L7*SIN(Q3-Q6-Q7)+L6*SI
     &N(Q3-Q5-Q6-Q7)-L2*SIN(Q3-Q4-Q5-Q6-Q7)) - MD*(L8*SIN(Q3-Q6-Q7)+L6*S
     &IN(Q3-Q5-Q6-Q7)-L2*SIN(Q3-Q4-Q5-Q6-Q7)) - ME*(L8*SIN(Q3-Q6-Q7)+L6*
     &SIN(Q3-Q5-Q6-Q7)-L2*SIN(Q3-Q4-Q5-Q6-Q7)) - MF*(L8*SIN(Q3-Q6-Q7)+L6
     &*SIN(Q3-Q5-Q6-Q7)-L2*SIN(Q3-Q4-Q5-Q6-Q7)) - MG*(L8*SIN(Q3-Q6-Q7)+L
     &6*SIN(Q3-Q5-Q6-Q7)-L2*SIN(Q3-Q4-Q5-Q6-Q7)) - 0.5D0*MB*(L4*SIN(Q3-Q
     &5-Q6-Q7)+L3*SIN(FOOTANG+Q3-Q5-Q6-Q7)-2*L2*SIN(Q3-Q4-Q5-Q6-Q7))
      COEF(6,2) = MC*(L7*COS(Q3-Q6-Q7)+L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4-
     &Q5-Q6-Q7)) + MD*(L8*COS(Q3-Q6-Q7)+L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4
     &-Q5-Q6-Q7)) + ME*(L8*COS(Q3-Q6-Q7)+L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q
     &4-Q5-Q6-Q7)) + MF*(L8*COS(Q3-Q6-Q7)+L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3-
     &Q4-Q5-Q6-Q7)) + MG*(L8*COS(Q3-Q6-Q7)+L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3
     &-Q4-Q5-Q6-Q7)) + 0.5D0*MB*(L4*COS(Q3-Q5-Q6-Q7)+L3*COS(FOOTANG+Q3-Q
     &5-Q6-Q7)-2*L2*COS(Q3-Q4-Q5-Q6-Q7)) - L1*MA*COS(Q3-Q4-Q5-Q6-Q7)
      COEF(6,3) = IA + IB + IC + MA*L1**2 + MC*(L2**2+L6**2+L7**2+2*L6*L
     &7*COS(Q5)-2*L2*L6*COS(Q4)-2*L2*L7*COS(Q4+Q5)) + 0.25D0*MB*(L3**2+L
     &4**2+4*L2**2+2*L3*L4*COS(FOOTANG)-4*L2*L4*COS(Q4)-4*L2*L3*COS(FOOT
     &ANG+Q4)) + MD*(L2**2+L6**2+L8**2+L8*L9*COS(Q6)+2*L6*L8*COS(Q5)+L6*
     &L9*COS(Q5+Q6)-2*L2*L6*COS(Q4)-2*L2*L8*COS(Q4+Q5)-L2*L9*COS(Q4+Q5+Q
     &6)) + MG*(L2**2+L6**2+L8**2+L10*L8*COS(Q6)+2*L6*L8*COS(Q5)+L10*L6*
     &COS(Q5+Q6)+L8*GS*COS(Q6+Q7)+L6*GS*COS(Q5+Q6+Q7)-2*L2*L6*COS(Q4)-2*
     &L2*L8*COS(Q4+Q5)-L10*L2*COS(Q4+Q5+Q6)-L2*GS*COS(Q4+Q5+Q6+Q7)) + ME
     &*(L2**2+L6**2+L8**2+L10*L8*COS(Q6)+2*L6*L8*COS(Q5)+L10*L6*COS(Q5+Q
     &6)+L8*(L10-L9)*COS(EA-Q6-Q7)+L6*(L10-L9)*COS(EA-Q5-Q6-Q7)-2*L2*L6*
     &COS(Q4)-2*L2*L8*COS(Q4+Q5)-L10*L2*COS(Q4+Q5+Q6)-L2*(L10-L9)*COS(EA
     &-Q4-Q5-Q6-Q7)) + MF*(L2**2+L6**2+L8**2+L10*L8*COS(Q6)+2*L6*L8*COS(
     &Q5)+L10*L6*COS(Q5+Q6)+L10*L8*COS(EA-Q6-Q7)+L10*L6*COS(EA-Q5-Q6-Q7)
     &+L8*(L7-L8)*COS(EA-FA-Q6-Q7)+L6*(L7-L8)*COS(EA-FA-Q5-Q6-Q7)-2*L2*L
     &6*COS(Q4)-2*L2*L8*COS(Q4+Q5)-L10*L2*COS(Q4+Q5+Q6)-L10*L2*COS(EA-Q4
     &-Q5-Q6-Q7)-L2*(L7-L8)*COS(EA-FA-Q4-Q5-Q6-Q7))
      COEF(6,4) = -IA - MA*L1**2 - L2*MC*(L2-L6*COS(Q4)-L7*COS(Q4+Q5)) -
     & L2*MD*(L2-L6*COS(Q4)-L8*COS(Q4+Q5)) - L2*ME*(L2-L6*COS(Q4)-L8*COS
     &(Q4+Q5)) - L2*MF*(L2-L6*COS(Q4)-L8*COS(Q4+Q5)) - L2*MG*(L2-L6*COS(
     &Q4)-L8*COS(Q4+Q5)) - 0.5D0*L2*MB*(2*L2-L4*COS(Q4)-L3*COS(FOOTANG+Q
     &4))
      COEF(6,5) = -IA - IB - MA*L1**2 - MC*(L2**2+L6**2+L6*L7*COS(Q5)-2*
     &L2*L6*COS(Q4)-L2*L7*COS(Q4+Q5)) - MD*(L2**2+L6**2+L6*L8*COS(Q5)-2*
     &L2*L6*COS(Q4)-L2*L8*COS(Q4+Q5)) - ME*(L2**2+L6**2+L6*L8*COS(Q5)-2*
     &L2*L6*COS(Q4)-L2*L8*COS(Q4+Q5)) - MF*(L2**2+L6**2+L6*L8*COS(Q5)-2*
     &L2*L6*COS(Q4)-L2*L8*COS(Q4+Q5)) - MG*(L2**2+L6**2+L6*L8*COS(Q5)-2*
     &L2*L6*COS(Q4)-L2*L8*COS(Q4+Q5)) - 0.25D0*MB*(L3**2+L4**2+4*L2**2+2
     &*L3*L4*COS(FOOTANG)-4*L2*L4*COS(Q4)-4*L2*L3*COS(FOOTANG+Q4))
      COEF(6,6) = -IA - IB - IC - MA*L1**2 - MC*(L2**2+L6**2+L7**2+2*L6*
     &L7*COS(Q5)-2*L2*L6*COS(Q4)-2*L2*L7*COS(Q4+Q5)) - MD*(L2**2+L6**2+L
     &8**2+2*L6*L8*COS(Q5)-2*L2*L6*COS(Q4)-2*L2*L8*COS(Q4+Q5)) - ME*(L2*
     &*2+L6**2+L8**2+2*L6*L8*COS(Q5)-2*L2*L6*COS(Q4)-2*L2*L8*COS(Q4+Q5))
     & - MF*(L2**2+L6**2+L8**2+2*L6*L8*COS(Q5)-2*L2*L6*COS(Q4)-2*L2*L8*C
     &OS(Q4+Q5)) - MG*(L2**2+L6**2+L8**2+2*L6*L8*COS(Q5)-2*L2*L6*COS(Q4)
     &-2*L2*L8*COS(Q4+Q5)) - 0.25D0*MB*(L3**2+L4**2+4*L2**2+2*L3*L4*COS(
     &FOOTANG)-4*L2*L4*COS(Q4)-4*L2*L3*COS(FOOTANG+Q4))
      COEF(6,7) = -IA - IB - IC - MA*L1**2 - MC*(L2**2+L6**2+L7**2+2*L6*
     &L7*COS(Q5)-2*L2*L6*COS(Q4)-2*L2*L7*COS(Q4+Q5)) - 0.25D0*MB*(L3**2+
     &L4**2+4*L2**2+2*L3*L4*COS(FOOTANG)-4*L2*L4*COS(Q4)-4*L2*L3*COS(FOO
     &TANG+Q4)) - MD*(L2**2+L6**2+L8**2+L8*L9*COS(Q6)+2*L6*L8*COS(Q5)+L6
     &*L9*COS(Q5+Q6)-2*L2*L6*COS(Q4)-2*L2*L8*COS(Q4+Q5)-L2*L9*COS(Q4+Q5+
     &Q6)) - ME*(L2**2+L6**2+L8**2+L10*L8*COS(Q6)+2*L6*L8*COS(Q5)+L10*L6
     &*COS(Q5+Q6)-2*L2*L6*COS(Q4)-2*L2*L8*COS(Q4+Q5)-L10*L2*COS(Q4+Q5+Q6
     &)) - MF*(L2**2+L6**2+L8**2+L10*L8*COS(Q6)+2*L6*L8*COS(Q5)+L10*L6*C
     &OS(Q5+Q6)-2*L2*L6*COS(Q4)-2*L2*L8*COS(Q4+Q5)-L10*L2*COS(Q4+Q5+Q6))
     & - MG*(L2**2+L6**2+L8**2+L10*L8*COS(Q6)+2*L6*L8*COS(Q5)+L10*L6*COS
     &(Q5+Q6)-2*L2*L6*COS(Q4)-2*L2*L8*COS(Q4+Q5)-L10*L2*COS(Q4+Q5+Q6))
      COEF(7,1) = L1*MA*SIN(Q3-Q4-Q5-Q6-Q7) - MC*(L7*SIN(Q3-Q6-Q7)+L6*SI
     &N(Q3-Q5-Q6-Q7)-L2*SIN(Q3-Q4-Q5-Q6-Q7)) - 0.5D0*MB*(L4*SIN(Q3-Q5-Q6
     &-Q7)+L3*SIN(FOOTANG+Q3-Q5-Q6-Q7)-2*L2*SIN(Q3-Q4-Q5-Q6-Q7)) - MD*(L
     &9*SIN(Q3-Q7)+L8*SIN(Q3-Q6-Q7)+L6*SIN(Q3-Q5-Q6-Q7)-L2*SIN(Q3-Q4-Q5-
     &Q6-Q7)) - ME*(L10*SIN(Q3-Q7)+L8*SIN(Q3-Q6-Q7)+L6*SIN(Q3-Q5-Q6-Q7)-
     &L2*SIN(Q3-Q4-Q5-Q6-Q7)) - MF*(L10*SIN(Q3-Q7)+L8*SIN(Q3-Q6-Q7)+L6*S
     &IN(Q3-Q5-Q6-Q7)-L2*SIN(Q3-Q4-Q5-Q6-Q7)) - MG*(L10*SIN(Q3-Q7)+L8*SI
     &N(Q3-Q6-Q7)+L6*SIN(Q3-Q5-Q6-Q7)-L2*SIN(Q3-Q4-Q5-Q6-Q7))
      COEF(7,2) = MC*(L7*COS(Q3-Q6-Q7)+L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4-
     &Q5-Q6-Q7)) + 0.5D0*MB*(L4*COS(Q3-Q5-Q6-Q7)+L3*COS(FOOTANG+Q3-Q5-Q6
     &-Q7)-2*L2*COS(Q3-Q4-Q5-Q6-Q7)) + MD*(L9*COS(Q3-Q7)+L8*COS(Q3-Q6-Q7
     &)+L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4-Q5-Q6-Q7)) + ME*(L10*COS(Q3-Q7)
     &+L8*COS(Q3-Q6-Q7)+L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4-Q5-Q6-Q7)) + MF
     &*(L10*COS(Q3-Q7)+L8*COS(Q3-Q6-Q7)+L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4
     &-Q5-Q6-Q7)) + MG*(L10*COS(Q3-Q7)+L8*COS(Q3-Q6-Q7)+L6*COS(Q3-Q5-Q6-
     &Q7)-L2*COS(Q3-Q4-Q5-Q6-Q7)) - L1*MA*COS(Q3-Q4-Q5-Q6-Q7)
      COEF(7,3) = IA + IB + IC + ID + MA*L1**2 + MC*(L2**2+L6**2+L7**2+2
     &*L6*L7*COS(Q5)-2*L2*L6*COS(Q4)-2*L2*L7*COS(Q4+Q5)) + 0.25D0*MB*(L3
     &**2+L4**2+4*L2**2+2*L3*L4*COS(FOOTANG)-4*L2*L4*COS(Q4)-4*L2*L3*COS
     &(FOOTANG+Q4)) + MD*(L2**2+L6**2+L8**2+L9**2+2*L6*L8*COS(Q5)+2*L8*L
     &9*COS(Q6)+2*L6*L9*COS(Q5+Q6)-2*L2*L6*COS(Q4)-2*L2*L8*COS(Q4+Q5)-2*
     &L2*L9*COS(Q4+Q5+Q6)) + MG*(L10**2+L2**2+L6**2+L8**2+L10*GS*COS(Q7)
     &+2*L10*L8*COS(Q6)+2*L6*L8*COS(Q5)+L8*GS*COS(Q6+Q7)+2*L10*L6*COS(Q5
     &+Q6)+L6*GS*COS(Q5+Q6+Q7)-2*L2*L6*COS(Q4)-2*L2*L8*COS(Q4+Q5)-2*L10*
     &L2*COS(Q4+Q5+Q6)-L2*GS*COS(Q4+Q5+Q6+Q7)) + ME*(L10**2+L2**2+L6**2+
     &L8**2+2*L10*L8*COS(Q6)+2*L6*L8*COS(Q5)+2*L10*L6*COS(Q5+Q6)+L10*(L1
     &0-L9)*COS(EA-Q7)+L8*(L10-L9)*COS(EA-Q6-Q7)+L6*(L10-L9)*COS(EA-Q5-Q
     &6-Q7)-2*L2*L6*COS(Q4)-2*L2*L8*COS(Q4+Q5)-2*L10*L2*COS(Q4+Q5+Q6)-L2
     &*(L10-L9)*COS(EA-Q4-Q5-Q6-Q7)) + MF*(L10**2+L2**2+L6**2+L8**2+2*L1
     &0*L8*COS(Q6)+2*L6*L8*COS(Q5)+2*L10*L6*COS(Q5+Q6)+L10**2*COS(EA-Q7)
     &+L10*L8*COS(EA-Q6-Q7)+L10*L6*COS(EA-Q5-Q6-Q7)+L10*(L7-L8)*COS(EA-F
     &A-Q7)+L8*(L7-L8)*COS(EA-FA-Q6-Q7)+L6*(L7-L8)*COS(EA-FA-Q5-Q6-Q7)-2
     &*L2*L6*COS(Q4)-2*L2*L8*COS(Q4+Q5)-2*L10*L2*COS(Q4+Q5+Q6)-L10*L2*CO
     &S(EA-Q4-Q5-Q6-Q7)-L2*(L7-L8)*COS(EA-FA-Q4-Q5-Q6-Q7))
      COEF(7,4) = -IA - MA*L1**2 - L2*MC*(L2-L6*COS(Q4)-L7*COS(Q4+Q5)) -
     & 0.5D0*L2*MB*(2*L2-L4*COS(Q4)-L3*COS(FOOTANG+Q4)) - L2*MD*(L2-L6*C
     &OS(Q4)-L8*COS(Q4+Q5)-L9*COS(Q4+Q5+Q6)) - L2*ME*(L2-L6*COS(Q4)-L8*C
     &OS(Q4+Q5)-L10*COS(Q4+Q5+Q6)) - L2*MF*(L2-L6*COS(Q4)-L8*COS(Q4+Q5)-
     &L10*COS(Q4+Q5+Q6)) - L2*MG*(L2-L6*COS(Q4)-L8*COS(Q4+Q5)-L10*COS(Q4
     &+Q5+Q6))
      COEF(7,5) = -IA - IB - MA*L1**2 - MC*(L2**2+L6**2+L6*L7*COS(Q5)-2*
     &L2*L6*COS(Q4)-L2*L7*COS(Q4+Q5)) - 0.25D0*MB*(L3**2+L4**2+4*L2**2+2
     &*L3*L4*COS(FOOTANG)-4*L2*L4*COS(Q4)-4*L2*L3*COS(FOOTANG+Q4)) - MD*
     &(L2**2+L6**2+L6*L8*COS(Q5)+L6*L9*COS(Q5+Q6)-2*L2*L6*COS(Q4)-L2*L8*
     &COS(Q4+Q5)-L2*L9*COS(Q4+Q5+Q6)) - ME*(L2**2+L6**2+L6*L8*COS(Q5)+L1
     &0*L6*COS(Q5+Q6)-2*L2*L6*COS(Q4)-L2*L8*COS(Q4+Q5)-L10*L2*COS(Q4+Q5+
     &Q6)) - MF*(L2**2+L6**2+L6*L8*COS(Q5)+L10*L6*COS(Q5+Q6)-2*L2*L6*COS
     &(Q4)-L2*L8*COS(Q4+Q5)-L10*L2*COS(Q4+Q5+Q6)) - MG*(L2**2+L6**2+L6*L
     &8*COS(Q5)+L10*L6*COS(Q5+Q6)-2*L2*L6*COS(Q4)-L2*L8*COS(Q4+Q5)-L10*L
     &2*COS(Q4+Q5+Q6))
      COEF(7,6) = -IA - IB - IC - MA*L1**2 - MC*(L2**2+L6**2+L7**2+2*L6*
     &L7*COS(Q5)-2*L2*L6*COS(Q4)-2*L2*L7*COS(Q4+Q5)) - 0.25D0*MB*(L3**2+
     &L4**2+4*L2**2+2*L3*L4*COS(FOOTANG)-4*L2*L4*COS(Q4)-4*L2*L3*COS(FOO
     &TANG+Q4)) - MD*(L2**2+L6**2+L8**2+L8*L9*COS(Q6)+2*L6*L8*COS(Q5)+L6
     &*L9*COS(Q5+Q6)-2*L2*L6*COS(Q4)-2*L2*L8*COS(Q4+Q5)-L2*L9*COS(Q4+Q5+
     &Q6)) - ME*(L2**2+L6**2+L8**2+L10*L8*COS(Q6)+2*L6*L8*COS(Q5)+L10*L6
     &*COS(Q5+Q6)-2*L2*L6*COS(Q4)-2*L2*L8*COS(Q4+Q5)-L10*L2*COS(Q4+Q5+Q6
     &)) - MF*(L2**2+L6**2+L8**2+L10*L8*COS(Q6)+2*L6*L8*COS(Q5)+L10*L6*C
     &OS(Q5+Q6)-2*L2*L6*COS(Q4)-2*L2*L8*COS(Q4+Q5)-L10*L2*COS(Q4+Q5+Q6))
     & - MG*(L2**2+L6**2+L8**2+L10*L8*COS(Q6)+2*L6*L8*COS(Q5)+L10*L6*COS
     &(Q5+Q6)-2*L2*L6*COS(Q4)-2*L2*L8*COS(Q4+Q5)-L10*L2*COS(Q4+Q5+Q6))
      COEF(7,7) = -IA - IB - IC - ID - MA*L1**2 - MC*(L2**2+L6**2+L7**2+
     &2*L6*L7*COS(Q5)-2*L2*L6*COS(Q4)-2*L2*L7*COS(Q4+Q5)) - 0.25D0*MB*(L
     &3**2+L4**2+4*L2**2+2*L3*L4*COS(FOOTANG)-4*L2*L4*COS(Q4)-4*L2*L3*CO
     &S(FOOTANG+Q4)) - MD*(L2**2+L6**2+L8**2+L9**2+2*L6*L8*COS(Q5)+2*L8*
     &L9*COS(Q6)+2*L6*L9*COS(Q5+Q6)-2*L2*L6*COS(Q4)-2*L2*L8*COS(Q4+Q5)-2
     &*L2*L9*COS(Q4+Q5+Q6)) - ME*(L10**2+L2**2+L6**2+L8**2+2*L10*L8*COS(
     &Q6)+2*L6*L8*COS(Q5)+2*L10*L6*COS(Q5+Q6)-2*L2*L6*COS(Q4)-2*L2*L8*CO
     &S(Q4+Q5)-2*L10*L2*COS(Q4+Q5+Q6)) - MF*(L10**2+L2**2+L6**2+L8**2+2*
     &L10*L8*COS(Q6)+2*L6*L8*COS(Q5)+2*L10*L6*COS(Q5+Q6)-2*L2*L6*COS(Q4)
     &-2*L2*L8*COS(Q4+Q5)-2*L10*L2*COS(Q4+Q5+Q6)) - MG*(L10**2+L2**2+L6*
     &*2+L8**2+2*L10*L8*COS(Q6)+2*L6*L8*COS(Q5)+2*L10*L6*COS(Q5+Q6)-2*L2
     &*L6*COS(Q4)-2*L2*L8*COS(Q4+Q5)-2*L10*L2*COS(Q4+Q5+Q6))
      RHS(1) = L1*MA*COS(Q3-Q4-Q5-Q6-Q7)*(U3-U4-U5-U6-U7)**2 - RX1 - RX2
     & - MC*(L7*COS(Q3-Q6-Q7)*(U3-U6-U7)**2+L6*COS(Q3-Q5-Q6-Q7)*(U3-U5-U
     &6-U7)**2-L2*COS(Q3-Q4-Q5-Q6-Q7)*(U3-U4-U5-U6-U7)**2) - 0.5D0*MB*(L
     &4*COS(Q3-Q5-Q6-Q7)*(U3-U5-U6-U7)**2+L3*COS(FOOTANG+Q3-Q5-Q6-Q7)*(U
     &3-U5-U6-U7)**2-2*L2*COS(Q3-Q4-Q5-Q6-Q7)*(U3-U4-U5-U6-U7)**2) - MD*
     &(L9*COS(Q3-Q7)*(U3-U7)**2+L8*COS(Q3-Q6-Q7)*(U3-U6-U7)**2+L6*COS(Q3
     &-Q5-Q6-Q7)*(U3-U5-U6-U7)**2-L2*COS(Q3-Q4-Q5-Q6-Q7)*(U3-U4-U5-U6-U7
     &)**2) - MG*(2*GSp*SIN(Q3)*U3+L10*COS(Q3-Q7)*(U3-U7)**2+L8*COS(Q3-Q
     &6-Q7)*(U3-U6-U7)**2+L6*COS(Q3-Q5-Q6-Q7)*(U3-U5-U6-U7)**2-COS(Q3)*(
     &GSpp-GS*U3**2)-L2*COS(Q3-Q4-Q5-Q6-Q7)*(U3-U4-U5-U6-U7)**2) - ME*((
     &L10-L9)*EApp*SIN(EA-Q3)+L10*COS(Q3-Q7)*(U3-U7)**2+(L10-L9)*COS(EA-
     &Q3)*(EAp-U3)**2+L8*COS(Q3-Q6-Q7)*(U3-U6-U7)**2+L6*COS(Q3-Q5-Q6-Q7)
     &*(U3-U5-U6-U7)**2-L2*COS(Q3-Q4-Q5-Q6-Q7)*(U3-U4-U5-U6-U7)**2) - MF
     &*(L10*EApp*SIN(EA-Q3)+(L7-L8)*(EApp-FApp)*SIN(EA-FA-Q3)+L10*COS(EA
     &-Q3)*(EAp-U3)**2+L10*COS(Q3-Q7)*(U3-U7)**2+L8*COS(Q3-Q6-Q7)*(U3-U6
     &-U7)**2+(L7-L8)*COS(EA-FA-Q3)*(EAp-FAp-U3)**2+L6*COS(Q3-Q5-Q6-Q7)*
     &(U3-U5-U6-U7)**2-L2*COS(Q3-Q4-Q5-Q6-Q7)*(U3-U4-U5-U6-U7)**2)
      RHS(2) = L1*MA*SIN(Q3-Q4-Q5-Q6-Q7)*(U3-U4-U5-U6-U7)**2 - G*MA - G*
     &MB - G*MC - G*MD - G*ME - G*MF - G*MG - RY1 - RY2 - MC*(L7*SIN(Q3-
     &Q6-Q7)*(U3-U6-U7)**2+L6*SIN(Q3-Q5-Q6-Q7)*(U3-U5-U6-U7)**2-L2*SIN(Q
     &3-Q4-Q5-Q6-Q7)*(U3-U4-U5-U6-U7)**2) - 0.5D0*MB*(L4*SIN(Q3-Q5-Q6-Q7
     &)*(U3-U5-U6-U7)**2+L3*SIN(FOOTANG+Q3-Q5-Q6-Q7)*(U3-U5-U6-U7)**2-2*
     &L2*SIN(Q3-Q4-Q5-Q6-Q7)*(U3-U4-U5-U6-U7)**2) - MD*(L9*SIN(Q3-Q7)*(U
     &3-U7)**2+L8*SIN(Q3-Q6-Q7)*(U3-U6-U7)**2+L6*SIN(Q3-Q5-Q6-Q7)*(U3-U5
     &-U6-U7)**2-L2*SIN(Q3-Q4-Q5-Q6-Q7)*(U3-U4-U5-U6-U7)**2) - MG*(L10*S
     &IN(Q3-Q7)*(U3-U7)**2+L8*SIN(Q3-Q6-Q7)*(U3-U6-U7)**2+L6*SIN(Q3-Q5-Q
     &6-Q7)*(U3-U5-U6-U7)**2-2*GSp*COS(Q3)*U3-SIN(Q3)*(GSpp-GS*U3**2)-L2
     &*SIN(Q3-Q4-Q5-Q6-Q7)*(U3-U4-U5-U6-U7)**2) - ME*((L10-L9)*EApp*COS(
     &EA-Q3)+L10*SIN(Q3-Q7)*(U3-U7)**2+L8*SIN(Q3-Q6-Q7)*(U3-U6-U7)**2+L6
     &*SIN(Q3-Q5-Q6-Q7)*(U3-U5-U6-U7)**2-(L10-L9)*SIN(EA-Q3)*(EAp-U3)**2
     &-L2*SIN(Q3-Q4-Q5-Q6-Q7)*(U3-U4-U5-U6-U7)**2) - MF*(L10*EApp*COS(EA
     &-Q3)+(L7-L8)*(EApp-FApp)*COS(EA-FA-Q3)+L10*SIN(Q3-Q7)*(U3-U7)**2+L
     &8*SIN(Q3-Q6-Q7)*(U3-U6-U7)**2+L6*SIN(Q3-Q5-Q6-Q7)*(U3-U5-U6-U7)**2
     &-L10*SIN(EA-Q3)*(EAp-U3)**2-(L7-L8)*SIN(EA-FA-Q3)*(EAp-FAp-U3)**2-
     &L2*SIN(Q3-Q4-Q5-Q6-Q7)*(U3-U4-U5-U6-U7)**2)
      RHS(3) = G*L1*MA*COS(Q3-Q4-Q5-Q6-Q7) + 0.5D0*L2*MB*(L4*SIN(Q4)*(U3
     &-U5-U6-U7)**2+L3*SIN(FOOTANG+Q4)*(U3-U5-U6-U7)**2-L4*SIN(Q4)*(U3-U
     &4-U5-U6-U7)**2-L3*SIN(FOOTANG+Q4)*(U3-U4-U5-U6-U7)**2) + MC*(L2*L7
     &*SIN(Q4+Q5)*(U3-U6-U7)**2+L2*L6*SIN(Q4)*(U3-U5-U6-U7)**2+L6*L7*SIN
     &(Q5)*(U3-U5-U6-U7)**2-L6*L7*SIN(Q5)*(U3-U6-U7)**2-L2*L6*SIN(Q4)*(U
     &3-U4-U5-U6-U7)**2-L2*L7*SIN(Q4+Q5)*(U3-U4-U5-U6-U7)**2) + MD*(L2*L
     &9*SIN(Q4+Q5+Q6)*(U3-U7)**2+L8*L9*SIN(Q6)*(U3-U6-U7)**2+L2*L8*SIN(Q
     &4+Q5)*(U3-U6-U7)**2+L2*L6*SIN(Q4)*(U3-U5-U6-U7)**2+L6*L8*SIN(Q5)*(
     &U3-U5-U6-U7)**2+L6*L9*SIN(Q5+Q6)*(U3-U5-U6-U7)**2-L8*L9*SIN(Q6)*(U
     &3-U7)**2-L6*L9*SIN(Q5+Q6)*(U3-U7)**2-L6*L8*SIN(Q5)*(U3-U6-U7)**2-L
     &2*L6*SIN(Q4)*(U3-U4-U5-U6-U7)**2-L2*L8*SIN(Q4+Q5)*(U3-U4-U5-U6-U7)
     &**2-L2*L9*SIN(Q4+Q5+Q6)*(U3-U4-U5-U6-U7)**2) + MG*(2*GS*GSp*U3+2*L
     &10*GSp*COS(Q7)*U3+2*L8*GSp*COS(Q6+Q7)*U3+2*L6*GSp*COS(Q5+Q6+Q7)*U3
     &+L10*SIN(Q7)*(GSpp-GS*U3**2)+L10*GS*SIN(Q7)*(U3-U7)**2+L8*SIN(Q6+Q
     &7)*(GSpp-GS*U3**2)+L10*L2*SIN(Q4+Q5+Q6)*(U3-U7)**2+L10*L8*SIN(Q6)*
     &(U3-U6-U7)**2+L6*SIN(Q5+Q6+Q7)*(GSpp-GS*U3**2)+L2*L8*SIN(Q4+Q5)*(U
     &3-U6-U7)**2+L8*GS*SIN(Q6+Q7)*(U3-U6-U7)**2+L2*L6*SIN(Q4)*(U3-U5-U6
     &-U7)**2+L6*L8*SIN(Q5)*(U3-U5-U6-U7)**2+L10*L6*SIN(Q5+Q6)*(U3-U5-U6
     &-U7)**2+L6*GS*SIN(Q5+Q6+Q7)*(U3-U5-U6-U7)**2-2*L2*GSp*COS(Q4+Q5+Q6
     &+Q7)*U3-L10*L8*SIN(Q6)*(U3-U7)**2-L10*L6*SIN(Q5+Q6)*(U3-U7)**2-L6*
     &L8*SIN(Q5)*(U3-U6-U7)**2-L2*SIN(Q4+Q5+Q6+Q7)*(GSpp-GS*U3**2)-L2*L6
     &*SIN(Q4)*(U3-U4-U5-U6-U7)**2-L2*L8*SIN(Q4+Q5)*(U3-U4-U5-U6-U7)**2-
     &L10*L2*SIN(Q4+Q5+Q6)*(U3-U4-U5-U6-U7)**2-L2*GS*SIN(Q4+Q5+Q6+Q7)*(U
     &3-U4-U5-U6-U7)**2) - IE*EApp - IF*(EApp-FApp) - L2*(RX2*SIN(Q3-Q4-
     &Q5-Q6-Q7)-RY2*COS(Q3-Q4-Q5-Q6-Q7)) - G*MC*(L7*COS(Q3-Q6-Q7)+L6*COS
     &(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4-Q5-Q6-Q7)) - 0.5D0*G*MB*(L4*COS(Q3-Q5-Q
     &6-Q7)+L3*COS(FOOTANG+Q3-Q5-Q6-Q7)-2*L2*COS(Q3-Q4-Q5-Q6-Q7)) - G*MD
     &*(L9*COS(Q3-Q7)+L8*COS(Q3-Q6-Q7)+L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4-
     &Q5-Q6-Q7)) - G*MG*(GS*COS(Q3)+L10*COS(Q3-Q7)+L8*COS(Q3-Q6-Q7)+L6*C
     &OS(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4-Q5-Q6-Q7)) - G*ME*(L10*COS(Q3-Q7)+L8*
     &COS(Q3-Q6-Q7)+(L10-L9)*COS(EA-Q3)+L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4
     &-Q5-Q6-Q7)) - G*MF*(L10*COS(EA-Q3)+L10*COS(Q3-Q7)+L8*COS(Q3-Q6-Q7)
     &+L6*COS(Q3-Q5-Q6-Q7)+(L7-L8)*COS(EA-FA-Q3)-L2*COS(Q3-Q4-Q5-Q6-Q7))
     & - ME*((L10-L9)**2*EApp+L10*(L10-L9)*EApp*COS(EA-Q7)+L8*(L10-L9)*E
     &App*COS(EA-Q6-Q7)+L6*(L10-L9)*EApp*COS(EA-Q5-Q6-Q7)+L10*L8*SIN(Q6)
     &*(U3-U7)**2+L10*L6*SIN(Q5+Q6)*(U3-U7)**2+L6*L8*SIN(Q5)*(U3-U6-U7)*
     &*2+L10*(L10-L9)*SIN(EA-Q7)*(U3-U7)**2+L2*L6*SIN(Q4)*(U3-U4-U5-U6-U
     &7)**2+L2*L8*SIN(Q4+Q5)*(U3-U4-U5-U6-U7)**2+L10*L2*SIN(Q4+Q5+Q6)*(U
     &3-U4-U5-U6-U7)**2+L8*(L10-L9)*SIN(EA-Q6-Q7)*(U3-U6-U7)**2+L2*(L10-
     &L9)*SIN(EA-Q4-Q5-Q6-Q7)*(EAp-U3)**2+L6*(L10-L9)*SIN(EA-Q5-Q6-Q7)*(
     &U3-U5-U6-U7)**2-L2*(L10-L9)*EApp*COS(EA-Q4-Q5-Q6-Q7)-L10*L2*SIN(Q4
     &+Q5+Q6)*(U3-U7)**2-L10*L8*SIN(Q6)*(U3-U6-U7)**2-L2*L8*SIN(Q4+Q5)*(
     &U3-U6-U7)**2-L2*L6*SIN(Q4)*(U3-U5-U6-U7)**2-L6*L8*SIN(Q5)*(U3-U5-U
     &6-U7)**2-L10*(L10-L9)*SIN(EA-Q7)*(EAp-U3)**2-L10*L6*SIN(Q5+Q6)*(U3
     &-U5-U6-U7)**2-L8*(L10-L9)*SIN(EA-Q6-Q7)*(EAp-U3)**2-L6*(L10-L9)*SI
     &N(EA-Q5-Q6-Q7)*(EAp-U3)**2-L2*(L10-L9)*SIN(EA-Q4-Q5-Q6-Q7)*(U3-U4-
     &U5-U6-U7)**2) - MF*(L10**2*EApp+L10*(L7-L8)*COS(FA)*EApp+(L7-L8)**
     &2*(EApp-FApp)+L10*(L7-L8)*COS(FA)*(EApp-FApp)+L10**2*EApp*COS(EA-Q
     &7)+L10*L8*EApp*COS(EA-Q6-Q7)+L10*L6*EApp*COS(EA-Q5-Q6-Q7)+L10*(L7-
     &L8)*(EApp-FApp)*COS(EA-FA-Q7)+L8*(L7-L8)*(EApp-FApp)*COS(EA-FA-Q6-
     &Q7)+L6*(L7-L8)*(EApp-FApp)*COS(EA-FA-Q5-Q6-Q7)+L10*L8*SIN(Q6)*(U3-
     &U7)**2+L10*L6*SIN(Q5+Q6)*(U3-U7)**2+L10**2*SIN(EA-Q7)*(U3-U7)**2+L
     &6*L8*SIN(Q5)*(U3-U6-U7)**2+L10*(L7-L8)*SIN(FA)*(EAp-FAp-U3)**2+L10
     &*L8*SIN(EA-Q6-Q7)*(U3-U6-U7)**2+L2*L6*SIN(Q4)*(U3-U4-U5-U6-U7)**2+
     &L10*(L7-L8)*SIN(EA-FA-Q7)*(U3-U7)**2+L2*L8*SIN(Q4+Q5)*(U3-U4-U5-U6
     &-U7)**2+L10*L2*SIN(EA-Q4-Q5-Q6-Q7)*(EAp-U3)**2+L10*L2*SIN(Q4+Q5+Q6
     &)*(U3-U4-U5-U6-U7)**2+L10*L6*SIN(EA-Q5-Q6-Q7)*(U3-U5-U6-U7)**2+L8*
     &(L7-L8)*SIN(EA-FA-Q6-Q7)*(U3-U6-U7)**2+L2*(L7-L8)*SIN(EA-FA-Q4-Q5-
     &Q6-Q7)*(EAp-FAp-U3)**2+L6*(L7-L8)*SIN(EA-FA-Q5-Q6-Q7)*(U3-U5-U6-U7
     &)**2-L10*L2*EApp*COS(EA-Q4-Q5-Q6-Q7)-L2*(L7-L8)*(EApp-FApp)*COS(EA
     &-FA-Q4-Q5-Q6-Q7)-L10*L2*SIN(Q4+Q5+Q6)*(U3-U7)**2-L10*L8*SIN(Q6)*(U
     &3-U6-U7)**2-L10**2*SIN(EA-Q7)*(EAp-U3)**2-L10*(L7-L8)*SIN(FA)*(EAp
     &-U3)**2-L2*L8*SIN(Q4+Q5)*(U3-U6-U7)**2-L10*L8*SIN(EA-Q6-Q7)*(EAp-U
     &3)**2-L2*L6*SIN(Q4)*(U3-U5-U6-U7)**2-L6*L8*SIN(Q5)*(U3-U5-U6-U7)**
     &2-L10*L6*SIN(Q5+Q6)*(U3-U5-U6-U7)**2-L10*L6*SIN(EA-Q5-Q6-Q7)*(EAp-
     &U3)**2-L10*(L7-L8)*SIN(EA-FA-Q7)*(EAp-FAp-U3)**2-L8*(L7-L8)*SIN(EA
     &-FA-Q6-Q7)*(EAp-FAp-U3)**2-L6*(L7-L8)*SIN(EA-FA-Q5-Q6-Q7)*(EAp-FAp
     &-U3)**2-L10*L2*SIN(EA-Q4-Q5-Q6-Q7)*(U3-U4-U5-U6-U7)**2-L2*(L7-L8)*
     &SIN(EA-FA-Q4-Q5-Q6-Q7)*(U3-U4-U5-U6-U7)**2)
      RHS(4) = L2*(RX2*SIN(Q3-Q4-Q5-Q6-Q7)-RY2*COS(Q3-Q4-Q5-Q6-Q7)) + 0.
     &5D0*L2*(2*MG*(2*GSp*COS(Q4+Q5+Q6+Q7)*U3+SIN(Q4+Q5+Q6+Q7)*(GSpp-GS*
     &U3**2)-L10*SIN(Q4+Q5+Q6)*(U3-U7)**2-L8*SIN(Q4+Q5)*(U3-U6-U7)**2-L6
     &*SIN(Q4)*(U3-U5-U6-U7)**2)-MB*(L4*SIN(Q4)+L3*SIN(FOOTANG+Q4))*(U3-
     &U5-U6-U7)**2-2*MC*(L7*SIN(Q4+Q5)*(U3-U6-U7)**2+L6*SIN(Q4)*(U3-U5-U
     &6-U7)**2)-2*MD*(L9*SIN(Q4+Q5+Q6)*(U3-U7)**2+L8*SIN(Q4+Q5)*(U3-U6-U
     &7)**2+L6*SIN(Q4)*(U3-U5-U6-U7)**2)-2*ME*((L10-L9)*EApp*COS(EA-Q4-Q
     &5-Q6-Q7)+L10*SIN(Q4+Q5+Q6)*(U3-U7)**2+L8*SIN(Q4+Q5)*(U3-U6-U7)**2+
     &L6*SIN(Q4)*(U3-U5-U6-U7)**2-(L10-L9)*SIN(EA-Q4-Q5-Q6-Q7)*(EAp-U3)*
     &*2)-2*MF*(L10*EApp*COS(EA-Q4-Q5-Q6-Q7)+(L7-L8)*(EApp-FApp)*COS(EA-
     &FA-Q4-Q5-Q6-Q7)+L10*SIN(Q4+Q5+Q6)*(U3-U7)**2+L8*SIN(Q4+Q5)*(U3-U6-
     &U7)**2+L6*SIN(Q4)*(U3-U5-U6-U7)**2-L10*SIN(EA-Q4-Q5-Q6-Q7)*(EAp-U3
     &)**2-(L7-L8)*SIN(EA-FA-Q4-Q5-Q6-Q7)*(EAp-FAp-U3)**2)) - MTOR - G*L
     &1*MA*COS(Q3-Q4-Q5-Q6-Q7) - G*L2*MB*COS(Q3-Q4-Q5-Q6-Q7) - G*L2*MC*C
     &OS(Q3-Q4-Q5-Q6-Q7) - G*L2*MD*COS(Q3-Q4-Q5-Q6-Q7) - G*L2*ME*COS(Q3-
     &Q4-Q5-Q6-Q7) - G*L2*MF*COS(Q3-Q4-Q5-Q6-Q7) - G*L2*MG*COS(Q3-Q4-Q5-
     &Q6-Q7)
      RHS(5) = G*MC*(L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4-Q5-Q6-Q7)) + G*MD*
     &(L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4-Q5-Q6-Q7)) + G*ME*(L6*COS(Q3-Q5-
     &Q6-Q7)-L2*COS(Q3-Q4-Q5-Q6-Q7)) + G*MF*(L6*COS(Q3-Q5-Q6-Q7)-L2*COS(
     &Q3-Q4-Q5-Q6-Q7)) + G*MG*(L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4-Q5-Q6-Q7
     &)) + L2*(RX2*SIN(Q3-Q4-Q5-Q6-Q7)-RY2*COS(Q3-Q4-Q5-Q6-Q7)) + 0.5D0*
     &G*MB*(L4*COS(Q3-Q5-Q6-Q7)+L3*COS(FOOTANG+Q3-Q5-Q6-Q7)-2*L2*COS(Q3-
     &Q4-Q5-Q6-Q7)) - ATOR - G*L1*MA*COS(Q3-Q4-Q5-Q6-Q7) - MC*(L2*L7*SIN
     &(Q4+Q5)*(U3-U6-U7)**2+L2*L6*SIN(Q4)*(U3-U5-U6-U7)**2-L6*L7*SIN(Q5)
     &*(U3-U6-U7)**2-L2*L6*SIN(Q4)*(U3-U4-U5-U6-U7)**2) - 0.5D0*L2*MB*(L
     &4*SIN(Q4)*(U3-U5-U6-U7)**2+L3*SIN(FOOTANG+Q4)*(U3-U5-U6-U7)**2-L4*
     &SIN(Q4)*(U3-U4-U5-U6-U7)**2-L3*SIN(FOOTANG+Q4)*(U3-U4-U5-U6-U7)**2
     &) - MD*(L2*L9*SIN(Q4+Q5+Q6)*(U3-U7)**2+L2*L8*SIN(Q4+Q5)*(U3-U6-U7)
     &**2+L2*L6*SIN(Q4)*(U3-U5-U6-U7)**2-L6*L9*SIN(Q5+Q6)*(U3-U7)**2-L6*
     &L8*SIN(Q5)*(U3-U6-U7)**2-L2*L6*SIN(Q4)*(U3-U4-U5-U6-U7)**2) - MG*(
     &2*L6*GSp*COS(Q5+Q6+Q7)*U3+L10*L2*SIN(Q4+Q5+Q6)*(U3-U7)**2+L6*SIN(Q
     &5+Q6+Q7)*(GSpp-GS*U3**2)+L2*L8*SIN(Q4+Q5)*(U3-U6-U7)**2+L2*L6*SIN(
     &Q4)*(U3-U5-U6-U7)**2-2*L2*GSp*COS(Q4+Q5+Q6+Q7)*U3-L10*L6*SIN(Q5+Q6
     &)*(U3-U7)**2-L6*L8*SIN(Q5)*(U3-U6-U7)**2-L2*SIN(Q4+Q5+Q6+Q7)*(GSpp
     &-GS*U3**2)-L2*L6*SIN(Q4)*(U3-U4-U5-U6-U7)**2) - ME*(L2*(L10-L9)*EA
     &pp*COS(EA-Q4-Q5-Q6-Q7)+L10*L2*SIN(Q4+Q5+Q6)*(U3-U7)**2+L2*L8*SIN(Q
     &4+Q5)*(U3-U6-U7)**2+L2*L6*SIN(Q4)*(U3-U5-U6-U7)**2+L6*(L10-L9)*SIN
     &(EA-Q5-Q6-Q7)*(EAp-U3)**2-L6*(L10-L9)*EApp*COS(EA-Q5-Q6-Q7)-L10*L6
     &*SIN(Q5+Q6)*(U3-U7)**2-L6*L8*SIN(Q5)*(U3-U6-U7)**2-L2*L6*SIN(Q4)*(
     &U3-U4-U5-U6-U7)**2-L2*(L10-L9)*SIN(EA-Q4-Q5-Q6-Q7)*(EAp-U3)**2) - 
     &MF*(L10*L2*EApp*COS(EA-Q4-Q5-Q6-Q7)+L2*(L7-L8)*(EApp-FApp)*COS(EA-
     &FA-Q4-Q5-Q6-Q7)+L10*L2*SIN(Q4+Q5+Q6)*(U3-U7)**2+L2*L8*SIN(Q4+Q5)*(
     &U3-U6-U7)**2+L2*L6*SIN(Q4)*(U3-U5-U6-U7)**2+L10*L6*SIN(EA-Q5-Q6-Q7
     &)*(EAp-U3)**2+L6*(L7-L8)*SIN(EA-FA-Q5-Q6-Q7)*(EAp-FAp-U3)**2-L10*L
     &6*EApp*COS(EA-Q5-Q6-Q7)-L6*(L7-L8)*(EApp-FApp)*COS(EA-FA-Q5-Q6-Q7)
     &-L10*L6*SIN(Q5+Q6)*(U3-U7)**2-L6*L8*SIN(Q5)*(U3-U6-U7)**2-L2*L6*SI
     &N(Q4)*(U3-U4-U5-U6-U7)**2-L10*L2*SIN(EA-Q4-Q5-Q6-Q7)*(EAp-U3)**2-L
     &2*(L7-L8)*SIN(EA-FA-Q4-Q5-Q6-Q7)*(EAp-FAp-U3)**2)
      RHS(6) = KTOR + L2*(RX2*SIN(Q3-Q4-Q5-Q6-Q7)-RY2*COS(Q3-Q4-Q5-Q6-Q7
     &)) + G*MC*(L7*COS(Q3-Q6-Q7)+L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4-Q5-Q6
     &-Q7)) + G*MD*(L8*COS(Q3-Q6-Q7)+L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4-Q5
     &-Q6-Q7)) + G*ME*(L8*COS(Q3-Q6-Q7)+L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4
     &-Q5-Q6-Q7)) + G*MF*(L8*COS(Q3-Q6-Q7)+L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3
     &-Q4-Q5-Q6-Q7)) + G*MG*(L8*COS(Q3-Q6-Q7)+L6*COS(Q3-Q5-Q6-Q7)-L2*COS
     &(Q3-Q4-Q5-Q6-Q7)) + 0.5D0*G*MB*(L4*COS(Q3-Q5-Q6-Q7)+L3*COS(FOOTANG
     &+Q3-Q5-Q6-Q7)-2*L2*COS(Q3-Q4-Q5-Q6-Q7)) - G*L1*MA*COS(Q3-Q4-Q5-Q6-
     &Q7) - 0.5D0*L2*MB*(L4*SIN(Q4)*(U3-U5-U6-U7)**2+L3*SIN(FOOTANG+Q4)*
     &(U3-U5-U6-U7)**2-L4*SIN(Q4)*(U3-U4-U5-U6-U7)**2-L3*SIN(FOOTANG+Q4)
     &*(U3-U4-U5-U6-U7)**2) - MC*(L2*L7*SIN(Q4+Q5)*(U3-U6-U7)**2+L2*L6*S
     &IN(Q4)*(U3-U5-U6-U7)**2+L6*L7*SIN(Q5)*(U3-U5-U6-U7)**2-L6*L7*SIN(Q
     &5)*(U3-U6-U7)**2-L2*L6*SIN(Q4)*(U3-U4-U5-U6-U7)**2-L2*L7*SIN(Q4+Q5
     &)*(U3-U4-U5-U6-U7)**2) - MD*(L2*L9*SIN(Q4+Q5+Q6)*(U3-U7)**2+L2*L8*
     &SIN(Q4+Q5)*(U3-U6-U7)**2+L2*L6*SIN(Q4)*(U3-U5-U6-U7)**2+L6*L8*SIN(
     &Q5)*(U3-U5-U6-U7)**2-L8*L9*SIN(Q6)*(U3-U7)**2-L6*L9*SIN(Q5+Q6)*(U3
     &-U7)**2-L6*L8*SIN(Q5)*(U3-U6-U7)**2-L2*L6*SIN(Q4)*(U3-U4-U5-U6-U7)
     &**2-L2*L8*SIN(Q4+Q5)*(U3-U4-U5-U6-U7)**2) - MG*(2*L8*GSp*COS(Q6+Q7
     &)*U3+2*L6*GSp*COS(Q5+Q6+Q7)*U3+L8*SIN(Q6+Q7)*(GSpp-GS*U3**2)+L10*L
     &2*SIN(Q4+Q5+Q6)*(U3-U7)**2+L6*SIN(Q5+Q6+Q7)*(GSpp-GS*U3**2)+L2*L8*
     &SIN(Q4+Q5)*(U3-U6-U7)**2+L2*L6*SIN(Q4)*(U3-U5-U6-U7)**2+L6*L8*SIN(
     &Q5)*(U3-U5-U6-U7)**2-2*L2*GSp*COS(Q4+Q5+Q6+Q7)*U3-L10*L8*SIN(Q6)*(
     &U3-U7)**2-L10*L6*SIN(Q5+Q6)*(U3-U7)**2-L6*L8*SIN(Q5)*(U3-U6-U7)**2
     &-L2*SIN(Q4+Q5+Q6+Q7)*(GSpp-GS*U3**2)-L2*L6*SIN(Q4)*(U3-U4-U5-U6-U7
     &)**2-L2*L8*SIN(Q4+Q5)*(U3-U4-U5-U6-U7)**2) - ME*(L2*(L10-L9)*EApp*
     &COS(EA-Q4-Q5-Q6-Q7)+L10*L2*SIN(Q4+Q5+Q6)*(U3-U7)**2+L2*L8*SIN(Q4+Q
     &5)*(U3-U6-U7)**2+L2*L6*SIN(Q4)*(U3-U5-U6-U7)**2+L6*L8*SIN(Q5)*(U3-
     &U5-U6-U7)**2+L8*(L10-L9)*SIN(EA-Q6-Q7)*(EAp-U3)**2+L6*(L10-L9)*SIN
     &(EA-Q5-Q6-Q7)*(EAp-U3)**2-L8*(L10-L9)*EApp*COS(EA-Q6-Q7)-L6*(L10-L
     &9)*EApp*COS(EA-Q5-Q6-Q7)-L10*L8*SIN(Q6)*(U3-U7)**2-L10*L6*SIN(Q5+Q
     &6)*(U3-U7)**2-L6*L8*SIN(Q5)*(U3-U6-U7)**2-L2*L6*SIN(Q4)*(U3-U4-U5-
     &U6-U7)**2-L2*L8*SIN(Q4+Q5)*(U3-U4-U5-U6-U7)**2-L2*(L10-L9)*SIN(EA-
     &Q4-Q5-Q6-Q7)*(EAp-U3)**2) - MF*(L10*L2*EApp*COS(EA-Q4-Q5-Q6-Q7)+L2
     &*(L7-L8)*(EApp-FApp)*COS(EA-FA-Q4-Q5-Q6-Q7)+L10*L2*SIN(Q4+Q5+Q6)*(
     &U3-U7)**2+L2*L8*SIN(Q4+Q5)*(U3-U6-U7)**2+L10*L8*SIN(EA-Q6-Q7)*(EAp
     &-U3)**2+L2*L6*SIN(Q4)*(U3-U5-U6-U7)**2+L6*L8*SIN(Q5)*(U3-U5-U6-U7)
     &**2+L10*L6*SIN(EA-Q5-Q6-Q7)*(EAp-U3)**2+L8*(L7-L8)*SIN(EA-FA-Q6-Q7
     &)*(EAp-FAp-U3)**2+L6*(L7-L8)*SIN(EA-FA-Q5-Q6-Q7)*(EAp-FAp-U3)**2-L
     &10*L8*EApp*COS(EA-Q6-Q7)-L10*L6*EApp*COS(EA-Q5-Q6-Q7)-L8*(L7-L8)*(
     &EApp-FApp)*COS(EA-FA-Q6-Q7)-L6*(L7-L8)*(EApp-FApp)*COS(EA-FA-Q5-Q6
     &-Q7)-L10*L8*SIN(Q6)*(U3-U7)**2-L10*L6*SIN(Q5+Q6)*(U3-U7)**2-L6*L8*
     &SIN(Q5)*(U3-U6-U7)**2-L2*L6*SIN(Q4)*(U3-U4-U5-U6-U7)**2-L2*L8*SIN(
     &Q4+Q5)*(U3-U4-U5-U6-U7)**2-L10*L2*SIN(EA-Q4-Q5-Q6-Q7)*(EAp-U3)**2-
     &L2*(L7-L8)*SIN(EA-FA-Q4-Q5-Q6-Q7)*(EAp-FAp-U3)**2)
      RHS(7) = L2*(RX2*SIN(Q3-Q4-Q5-Q6-Q7)-RY2*COS(Q3-Q4-Q5-Q6-Q7)) + G*
     &MC*(L7*COS(Q3-Q6-Q7)+L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4-Q5-Q6-Q7)) +
     & 0.5D0*G*MB*(L4*COS(Q3-Q5-Q6-Q7)+L3*COS(FOOTANG+Q3-Q5-Q6-Q7)-2*L2*
     &COS(Q3-Q4-Q5-Q6-Q7)) + G*MD*(L9*COS(Q3-Q7)+L8*COS(Q3-Q6-Q7)+L6*COS
     &(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4-Q5-Q6-Q7)) + G*ME*(L10*COS(Q3-Q7)+L8*CO
     &S(Q3-Q6-Q7)+L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4-Q5-Q6-Q7)) + G*MF*(L1
     &0*COS(Q3-Q7)+L8*COS(Q3-Q6-Q7)+L6*COS(Q3-Q5-Q6-Q7)-L2*COS(Q3-Q4-Q5-
     &Q6-Q7)) + G*MG*(L10*COS(Q3-Q7)+L8*COS(Q3-Q6-Q7)+L6*COS(Q3-Q5-Q6-Q7
     &)-L2*COS(Q3-Q4-Q5-Q6-Q7)) - HTOR - G*L1*MA*COS(Q3-Q4-Q5-Q6-Q7) - 0
     &.5D0*L2*MB*(L4*SIN(Q4)*(U3-U5-U6-U7)**2+L3*SIN(FOOTANG+Q4)*(U3-U5-
     &U6-U7)**2-L4*SIN(Q4)*(U3-U4-U5-U6-U7)**2-L3*SIN(FOOTANG+Q4)*(U3-U4
     &-U5-U6-U7)**2) - MC*(L2*L7*SIN(Q4+Q5)*(U3-U6-U7)**2+L2*L6*SIN(Q4)*
     &(U3-U5-U6-U7)**2+L6*L7*SIN(Q5)*(U3-U5-U6-U7)**2-L6*L7*SIN(Q5)*(U3-
     &U6-U7)**2-L2*L6*SIN(Q4)*(U3-U4-U5-U6-U7)**2-L2*L7*SIN(Q4+Q5)*(U3-U
     &4-U5-U6-U7)**2) - MD*(L2*L9*SIN(Q4+Q5+Q6)*(U3-U7)**2+L8*L9*SIN(Q6)
     &*(U3-U6-U7)**2+L2*L8*SIN(Q4+Q5)*(U3-U6-U7)**2+L2*L6*SIN(Q4)*(U3-U5
     &-U6-U7)**2+L6*L8*SIN(Q5)*(U3-U5-U6-U7)**2+L6*L9*SIN(Q5+Q6)*(U3-U5-
     &U6-U7)**2-L8*L9*SIN(Q6)*(U3-U7)**2-L6*L9*SIN(Q5+Q6)*(U3-U7)**2-L6*
     &L8*SIN(Q5)*(U3-U6-U7)**2-L2*L6*SIN(Q4)*(U3-U4-U5-U6-U7)**2-L2*L8*S
     &IN(Q4+Q5)*(U3-U4-U5-U6-U7)**2-L2*L9*SIN(Q4+Q5+Q6)*(U3-U4-U5-U6-U7)
     &**2) - MG*(2*L10*GSp*COS(Q7)*U3+2*L8*GSp*COS(Q6+Q7)*U3+2*L6*GSp*CO
     &S(Q5+Q6+Q7)*U3+L10*SIN(Q7)*(GSpp-GS*U3**2)+L8*SIN(Q6+Q7)*(GSpp-GS*
     &U3**2)+L10*L2*SIN(Q4+Q5+Q6)*(U3-U7)**2+L10*L8*SIN(Q6)*(U3-U6-U7)**
     &2+L6*SIN(Q5+Q6+Q7)*(GSpp-GS*U3**2)+L2*L8*SIN(Q4+Q5)*(U3-U6-U7)**2+
     &L2*L6*SIN(Q4)*(U3-U5-U6-U7)**2+L6*L8*SIN(Q5)*(U3-U5-U6-U7)**2+L10*
     &L6*SIN(Q5+Q6)*(U3-U5-U6-U7)**2-2*L2*GSp*COS(Q4+Q5+Q6+Q7)*U3-L10*L8
     &*SIN(Q6)*(U3-U7)**2-L10*L6*SIN(Q5+Q6)*(U3-U7)**2-L6*L8*SIN(Q5)*(U3
     &-U6-U7)**2-L2*SIN(Q4+Q5+Q6+Q7)*(GSpp-GS*U3**2)-L2*L6*SIN(Q4)*(U3-U
     &4-U5-U6-U7)**2-L2*L8*SIN(Q4+Q5)*(U3-U4-U5-U6-U7)**2-L10*L2*SIN(Q4+
     &Q5+Q6)*(U3-U4-U5-U6-U7)**2) - ME*(L2*(L10-L9)*EApp*COS(EA-Q4-Q5-Q6
     &-Q7)+L10*L2*SIN(Q4+Q5+Q6)*(U3-U7)**2+L10*L8*SIN(Q6)*(U3-U6-U7)**2+
     &L2*L8*SIN(Q4+Q5)*(U3-U6-U7)**2+L2*L6*SIN(Q4)*(U3-U5-U6-U7)**2+L6*L
     &8*SIN(Q5)*(U3-U5-U6-U7)**2+L10*(L10-L9)*SIN(EA-Q7)*(EAp-U3)**2+L10
     &*L6*SIN(Q5+Q6)*(U3-U5-U6-U7)**2+L8*(L10-L9)*SIN(EA-Q6-Q7)*(EAp-U3)
     &**2+L6*(L10-L9)*SIN(EA-Q5-Q6-Q7)*(EAp-U3)**2-L10*(L10-L9)*EApp*COS
     &(EA-Q7)-L8*(L10-L9)*EApp*COS(EA-Q6-Q7)-L6*(L10-L9)*EApp*COS(EA-Q5-
     &Q6-Q7)-L10*L8*SIN(Q6)*(U3-U7)**2-L10*L6*SIN(Q5+Q6)*(U3-U7)**2-L6*L
     &8*SIN(Q5)*(U3-U6-U7)**2-L2*L6*SIN(Q4)*(U3-U4-U5-U6-U7)**2-L2*L8*SI
     &N(Q4+Q5)*(U3-U4-U5-U6-U7)**2-L10*L2*SIN(Q4+Q5+Q6)*(U3-U4-U5-U6-U7)
     &**2-L2*(L10-L9)*SIN(EA-Q4-Q5-Q6-Q7)*(EAp-U3)**2) - MF*(L10*L2*EApp
     &*COS(EA-Q4-Q5-Q6-Q7)+L2*(L7-L8)*(EApp-FApp)*COS(EA-FA-Q4-Q5-Q6-Q7)
     &+L10*L2*SIN(Q4+Q5+Q6)*(U3-U7)**2+L10*L8*SIN(Q6)*(U3-U6-U7)**2+L10*
     &*2*SIN(EA-Q7)*(EAp-U3)**2+L2*L8*SIN(Q4+Q5)*(U3-U6-U7)**2+L10*L8*SI
     &N(EA-Q6-Q7)*(EAp-U3)**2+L2*L6*SIN(Q4)*(U3-U5-U6-U7)**2+L6*L8*SIN(Q
     &5)*(U3-U5-U6-U7)**2+L10*L6*SIN(Q5+Q6)*(U3-U5-U6-U7)**2+L10*L6*SIN(
     &EA-Q5-Q6-Q7)*(EAp-U3)**2+L10*(L7-L8)*SIN(EA-FA-Q7)*(EAp-FAp-U3)**2
     &+L8*(L7-L8)*SIN(EA-FA-Q6-Q7)*(EAp-FAp-U3)**2+L6*(L7-L8)*SIN(EA-FA-
     &Q5-Q6-Q7)*(EAp-FAp-U3)**2-L10**2*EApp*COS(EA-Q7)-L10*L8*EApp*COS(E
     &A-Q6-Q7)-L10*L6*EApp*COS(EA-Q5-Q6-Q7)-L10*(L7-L8)*(EApp-FApp)*COS(
     &EA-FA-Q7)-L8*(L7-L8)*(EApp-FApp)*COS(EA-FA-Q6-Q7)-L6*(L7-L8)*(EApp
     &-FApp)*COS(EA-FA-Q5-Q6-Q7)-L10*L8*SIN(Q6)*(U3-U7)**2-L10*L6*SIN(Q5
     &+Q6)*(U3-U7)**2-L6*L8*SIN(Q5)*(U3-U6-U7)**2-L2*L6*SIN(Q4)*(U3-U4-U
     &5-U6-U7)**2-L2*L8*SIN(Q4+Q5)*(U3-U4-U5-U6-U7)**2-L10*L2*SIN(EA-Q4-
     &Q5-Q6-Q7)*(EAp-U3)**2-L10*L2*SIN(Q4+Q5+Q6)*(U3-U4-U5-U6-U7)**2-L2*
     &(L7-L8)*SIN(EA-FA-Q4-Q5-Q6-Q7)*(EAp-FAp-U3)**2)
      CALL SOLVE(7,COEF,RHS,VARp)

C**   Update variables after uncoupling equations
      U1p = VARp(1)
      U2p = VARp(2)
      U3p = VARp(3)
      U4p = VARp(4)
      U5p = VARp(5)
      U6p = VARp(6)
      U7p = VARp(7)

C**   Update derivative array prior to integration step
      VARp(1) = Q1p
      VARp(2) = Q2p
      VARp(3) = Q3p
      VARp(4) = Q4p
      VARp(5) = Q5p
      VARp(6) = Q6p
      VARp(7) = Q7p
      VARp(8) = U1p
      VARp(9) = U2p
      VARp(10) = U3p
      VARp(11) = U4p
      VARp(12) = U5p
      VARp(13) = U6p
      VARp(14) = U7p

      RETURN
      END


C**********************************************************************
      SUBROUTINE INITCOND()      
C Subroutines used to convert model inputs into generalised coordinates.
C Input file (.in) contains CM velocities and joint angles/angular 
C velocities.
C
C Input/Output all through COMMON blocks
C
C***********************************************************************
      IMPLICIT DOUBLE PRECISION (A-Z)
      INTEGER          NROW
      DIMENSION        TT(500),CCHIP(6,500),CCKNEE(6,500),CCHAT(6,500)
      COMMON/CONSTNTS/ FOOTANG,G,IA,IB,IC,ID,IE,IF,IG,K1,K2,K3,K4,K5,K6,
     &K7,K8,L1,L10,L11,L2,L3,L4,L5,L6,L7,L8,L9,MA,MB,MC,MD,ME,MF,MG
      COMMON/INITIAL / Q1I,Q2I,Q3I,Q4I,Q5I,Q6I,Q7I,U1I,U2I,U3I,U4I,U5I,U
     &6I,U7I
      COMMON/ALGBRAIC/ AANG,AANGVEL,AETOR,AFTOR,ATOR,COP,GRF,HANG,HANGVE
     &L,HETOR,HFTOR,HTOR,HZ,KANG,KANGVEL,KECM,KETOR,KFTOR,KTOR,MANG,MANG
     &VEL,METOR,MFTOR,MTOR,PECM,PX,PY,RX,RX1,RX2,RY,RY1,RY2,SHANG,SHANGV
     &EL,SHTOR,SKANG,SKANGVEL,SKTOR,TE,U8,U9,Q1p,Q2p,Q3p,Q4p,Q5p,Q6p,Q7p
     &,U1p,U2p,U3p,U4p,U5p,U6p,U7p,AEACT,AECCANG,AECCANGVEL,AESECANG,AES
     &ECANGVEL,AFACT,AFCCANG,AFCCANGVEL,AFSECANG,AFSECANGVEL,EA,FA,GS,HE
     &ACT,HECCANG,HECCANGVEL,HESECANG,HESECANGVEL,HFACT,HFCCANG,HFCCANGV
     &EL,HFSECANG,HFSECANGVEL,KEACT,KECCANG,KECCANGVEL,KESECANG,KESECANG
     &VEL,KFACT,KFCCANG,KFCCANGVEL,KFSECANG,KFSECANGVEL,MEACT,MECCANG,ME
     &CCANGVEL,MESECANG,MESECANGVEL,MFACT,MFCCANG,MFCCANGVEL,MFSECANG,MF
     &SECANGVEL,EAp,FAp,GSp,EApp,FApp,GSpp,MT,POCMSTANCEX,POCMSTANCEY,PO
     &CMSWINGX,POCMSWINGY,POCMX,POCMY,POGOX,POGOY,POP1X,POP1Y,POP2X,POP2
     &Y,POP3X,POP3Y,POP4X,POP4Y,POP5X,POP5Y,POP6X,POP6Y,POP7X,POP7Y,POP8
     &X,POP8Y,POP9X,POP9Y,VOCMX,VOCMY,VOP2X,VOP2Y
      COMMON/MISCLLNS/ PI,DEGtoRAD,RADtoDEG,COEF(7,7),RHS(7)
      COMMON/INTEG   / TINITIAL,TFINAL,INTEGSTP,ABSERR,RELERR,PRINTINT
      COMMON/SPLNCOEF/ TT,CCHIP,CCKNEE,CCHAT,NROW

C** Global variables
      PI       = 4*ATAN(1.0D0)
      DEGtoRAD = PI/180.0D0
      RADtoDEG = 180.0D0/PI
      FOOTANG = FOOTANG*DEGtoRAD
      U8      = 0.0D0
      U9      = 0.0D0
      MT = MA + MB + MC + MD + ME + MF + MG

C** Local variables
      Q1 = Q1I
      Q2 = Q2I
      Q3 = Q3I*DEGtoRAD
      Q4 = Q4I*DEGtoRAD
      Q5 = Q5I*DEGtoRAD
      Q6 = Q6I*DEGtoRAD
      Q7 = Q7I*DEGtoRAD
      U1 = U1I
      U2 = U2I
      U3 = U3I*DEGtoRAD
      U4 = U4I*DEGtoRAD
      U5 = U5I*DEGtoRAD
      U6 = U6I*DEGtoRAD
      U7 = U7I*DEGtoRAD

      MANG    = Q4
      AANG    = Q5
      KANG    = Q6
      HANG    = Q7 
      MANGVEL = U4
      AANGVEL = U5
      KANGVEL = U6
      HANGVEL = U7
      VOCMX   = U1
      VOCMY   = U2

C** Convert joint angles to generalised coordinates/speeds
      Q4 = MANG
      Q5 = AANG - PI
      Q6 = PI - KANG
      Q7 = HANG - PI
      U4 = MANGVEL
      U5 = AANGVEL
      U6 = -KANGVEL
      U7 = HANGVEL
      
      CALL EVALSPLINE2(TINITIAL,NROW,TT,CCHIP,EA,EAp,EApp)
      CALL EVALSPLINE2(TINITIAL,NROW,TT,CCKNEE,FA,FAp,FApp)
      EA   = EA  *DEGtoRAD 
      EAp  = EAp *DEGtoRAD 
      EApp = EApp*DEGtoRAD 
      FA   = FA  *DEGtoRAD 
      FAp  = FAp *DEGtoRAD 
      FApp = FApp*DEGtoRAD 
      CALL EVALSPLINE2(TINITIAL,NROW,TT,CCHAT,GS,GSp,GSpp)

C** Convert CoM velocities to generalised speeds
      U1 = VOCMX + 0.5*(2*MG*GS*SIN(Q3)*U3+2*(L10*ME+L10*MF+L10*MG+L9*MD
     &)*SIN(Q3-Q7)*(U3-U7)+2*(L10*MF+ME*(L10-L9))*SIN(EA-Q3)*(EAp-U3-U8)
     &+L3*MB*SIN(FOOTANG+Q3-Q5-Q6-Q7)*(U3-U5-U6-U7)+2*MF*(L7-L8)*SIN(EA-
     &FA-Q3)*(EAp-FAp-U3-U8-U9)+2*(L7*MC+L8*MD+L8*ME+L8*MF+L8*MG)*SIN(Q3
     &-Q6-Q7)*(U3-U6-U7)+(L4*MB+2*L6*MC+2*L6*MD+2*L6*ME+2*L6*MF+2*L6*MG)
     &*SIN(Q3-Q5-Q6-Q7)*(U3-U5-U6-U7)-2*MG*GSp*COS(Q3)-2*(L1*MA+L2*MB+L2
     &*MC+L2*MD+L2*ME+L2*MF+L2*MG)*SIN(Q3-Q4-Q5-Q6-Q7)*(U3-U4-U5-U6-U7))
     &/(MA+MB+MC+MD+ME+MF+MG)
      U2 = VOCMY - 0.5*(2*MG*GSp*SIN(Q3)+2*MG*GS*COS(Q3)*U3+2*(L10*ME+L1
     &0*MF+L10*MG+L9*MD)*COS(Q3-Q7)*(U3-U7)+L3*MB*COS(FOOTANG+Q3-Q5-Q6-Q
     &7)*(U3-U5-U6-U7)+2*(L7*MC+L8*MD+L8*ME+L8*MF+L8*MG)*COS(Q3-Q6-Q7)*(
     &U3-U6-U7)+(L4*MB+2*L6*MC+2*L6*MD+2*L6*ME+2*L6*MF+2*L6*MG)*COS(Q3-Q
     &5-Q6-Q7)*(U3-U5-U6-U7)-2*(L10*MF+ME*(L10-L9))*COS(EA-Q3)*(EAp-U3-U
     &8)-2*MF*(L7-L8)*COS(EA-FA-Q3)*(EAp-FAp-U3-U8-U9)-2*(L1*MA+L2*MB+L2
     &*MC+L2*MD+L2*ME+L2*MF+L2*MG)*COS(Q3-Q4-Q5-Q6-Q7)*(U3-U4-U5-U6-U7))
     &/(MA+MB+MC+MD+ME+MF+MG)

C** Global intial variables
      Q1I = Q1
      Q2I = Q2
      Q3I = Q3
      Q4I = Q4
      Q5I = Q5
      Q6I = Q6
      Q7I = Q7
      U1I = U1
      U2I = U2
      U3I = U3
      U4I = U4
      U5I = U5
      U6I = U6
      U7I = U7


      END SUBROUTINE INITCOND
      
C***********************************************************************
      SUBROUTINE UPDATE(T)
C Wrapper to calculate joint torques for each timestep 
C Input/Output all through COMMON blocks
C
C***********************************************************************
      IMPLICIT DOUBLE PRECISION(A -Z)
      INTEGER          NACTP
      PARAMETER        (NACTP=7)
      DIMENSION        HETQP(10),HFTQP(10),KETQP(10),KFTQP(10),AETQP(10)
     &,AFTQP(10),HEACTP(NACTP),HFACTP(NACTP),KEACTP(NACTP),KFACTP(NACTP)
     &,AEACTP(NACTP),AFACTP(NACTP),METQP(10),MFTQP(10)
      COMMON/CONSTNTS/ FOOTANG,G,IA,IB,IC,ID,IE,IF,IG,K1,K2,K3,K4,K5,K6,
     &K7,K8,L1,L10,L11,L2,L3,L4,L5,L6,L7,L8,L9,MA,MB,MC,MD,ME,MF,MG
      COMMON/INITIAL / Q1I,Q2I,Q3I,Q4I,Q5I,Q6I,Q7I,U1I,U2I,U3I,U4I,U5I,U
     &6I,U7I
      COMMON/VARIBLES/ Q1,Q2,Q3,Q4,Q5,Q6,Q7,U1,U2,U3,U4,U5,U6,U7
      COMMON/ALGBRAIC/ AANG,AANGVEL,AETOR,AFTOR,ATOR,COP,GRF,HANG,HANGVE
     &L,HETOR,HFTOR,HTOR,HZ,KANG,KANGVEL,KECM,KETOR,KFTOR,KTOR,MANG,MANG
     &VEL,METOR,MFTOR,MTOR,PECM,PX,PY,RX,RX1,RX2,RY,RY1,RY2,SHANG,SHANGV
     &EL,SHTOR,SKANG,SKANGVEL,SKTOR,TE,U8,U9,Q1p,Q2p,Q3p,Q4p,Q5p,Q6p,Q7p
     &,U1p,U2p,U3p,U4p,U5p,U6p,U7p,AEACT,AECCANG,AECCANGVEL,AESECANG,AES
     &ECANGVEL,AFACT,AFCCANG,AFCCANGVEL,AFSECANG,AFSECANGVEL,EA,FA,GS,HE
     &ACT,HECCANG,HECCANGVEL,HESECANG,HESECANGVEL,HFACT,HFCCANG,HFCCANGV
     &EL,HFSECANG,HFSECANGVEL,KEACT,KECCANG,KECCANGVEL,KESECANG,KESECANG
     &VEL,KFACT,KFCCANG,KFCCANGVEL,KFSECANG,KFSECANGVEL,MEACT,MECCANG,ME
     &CCANGVEL,MESECANG,MESECANGVEL,MFACT,MFCCANG,MFCCANGVEL,MFSECANG,MF
     &SECANGVEL,EAp,FAp,GSp,EApp,FApp,GSpp,MT,POCMSTANCEX,POCMSTANCEY,PO
     &CMSWINGX,POCMSWINGY,POCMX,POCMY,POGOX,POGOY,POP1X,POP1Y,POP2X,POP2
     &Y,POP3X,POP3Y,POP4X,POP4Y,POP5X,POP5Y,POP6X,POP6Y,POP7X,POP7Y,POP8
     &X,POP8Y,POP9X,POP9Y,VOCMX,VOCMY,VOP2X,VOP2Y
      COMMON/MISCLLNS/ PI,DEGtoRAD,RADtoDEG,COEF(7,7),RHS(7)
      COMMON/INTEG   / TINITIAL,TFINAL,INTEGSTP,ABSERR,RELERR,PRINTINT
      COMMON/TQPARAMS/ HETQP,HFTQP,KETQP,KFTQP,AETQP,AFTQP,METQP,MFTQP
      COMMON/ACTPARAM/ HEACTP,HFACTP,KEACTP,KFACTP,AEACTP,AFACTP

      HANG = 3.141592653589793D0 + Q7
      KANG = 3.141592653589793D0 - Q6
      AANG = 3.141592653589793D0 + Q5
      MANG = Q4
      HANGVEL = U7
      KANGVEL = -U6
      AANGVEL = U5
      MANGVEL = U4

      CALL MUSCLEMODEL(T,HETQP(1:9),HEACTP,HETQP(10),2*PI-HANG,-HANGVEL,
     &HETOR,HESECANG,HESECANGVEL,HECCANG,HECCANGVEL,INTEGSTP,2)
      CALL MUSCLEMODEL(T,KETQP(1:9),KEACTP,KETQP(10),2*PI-KANG,-KANGVEL,
     &KETOR,KESECANG,KESECANGVEL,KECCANG,KECCANGVEL,INTEGSTP,2)
      CALL MUSCLEMODEL(T,AETQP(1:9),AEACTP,AETQP(10),2*PI-AANG,-AANGVEL,
     &AETOR,AESECANG,AESECANGVEL,AECCANG,AECCANGVEL,INTEGSTP,2)
      CALL MUSCLEMODEL(T,HFTQP(1:9),HFACTP,HFTQP(10),HANG,HANGVEL,HFTOR,
     &HFSECANG,HFSECANGVEL,HFCCANG,HFCCANGVEL,INTEGSTP,2)
      CALL MUSCLEMODEL(T,KFTQP(1:9),KFACTP,KFTQP(10),KANG,KANGVEL,KFTOR,
     &KFSECANG,KFSECANGVEL,KFCCANG,KFCCANGVEL,INTEGSTP,2)
      CALL MUSCLEMODEL(T,AFTQP(1:9),AFACTP,AFTQP(10),AANG,AANGVEL,AFTOR,
     &AFSECANG,AFSECANGVEL,AFCCANG,AFCCANGVEL,INTEGSTP,2)
      CALL MUSCLEMODEL(T,METQP(1:9),AEACTP,METQP(10),MANG,MANGVEL,METOR,
     &MESECANG,MESECANGVEL,MECCANG,MECCANGVEL,INTEGSTP,2)
      CALL MUSCLEMODEL(T,MFTQP(1:9),AFACTP,MFTQP(10),MANG,MANGVEL,MFTOR,
     &MFSECANG,MFSECANGVEL,MFCCANG,MFCCANGVEL,INTEGSTP,2)

      HTOR = HETOR - HFTOR
      KTOR = KETOR - KFTOR
      ATOR = AETOR - AFTOR 
      MTOR = METOR - MFTOR

      END SUBROUTINE UPDATE